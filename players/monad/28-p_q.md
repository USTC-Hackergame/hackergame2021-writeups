# pğŸ˜­q

<del>éŸ³ä¹çš„æ­£ç»Ÿåœ¨äºçœ‹ FFT å¬éŸ³ä¹ï¼</del>

è¿™é“é¢˜æœ¬è´¨ä¸Šå°±æ˜¯æŠŠé¢‘è°±å›¾è½¬æ¢ä¸ºå£°æ³¢ã€‚

æˆ‘æœ¬æ¥ä»¥ä¸ºè¿™é“é¢˜è¿˜è¦æ‰‹æ’• FFT çš„ï¼Œç»“æœå‘ç°å®Œå…¨ä¸ç”¨ï¼Œé¦–å…ˆç»™äº†ä»£ç ï¼Œå†è€…\[è§ä¸‹æ–‡\]ï¼Œäºæ˜¯è¿™é“é¢˜å°±å®Œå…¨æ˜¯ä¸€é“å·¥ç¨‹é¢˜ï¼Œåªè¦ä¼šè°ƒåº“å°±å¯ä»¥äº†ã€‚

çœ‹æºç ï¼Œæºç å¤§è‡´å¯ä»¥åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼šæ­£å‘ FFTï¼Œå’Œ gif ç”Ÿæˆã€‚

æˆ‘ä»¬å°±åè¿‡æ¥â€œé€†å‘â€æ¯ä¸€æ­¥å°±è¡Œäº†ã€‚

é¦–å…ˆæ˜¯è¯» gifï¼Œè¿™ä¸ªæ²¡å•¥å¥½è¯´çš„ï¼Œåªæ˜¯ç»†èŠ‚æ¯”è¾ƒå¤šï¼Œç›´æ¥ä¸Šä»£ç ï¼ˆè¶´ï¼‰ï¼š

```python
image = Image.open('flag.gif')

db_frames = []

for i, gif_frame in enumerate(ImageSequence.Iterator(image)):
    # å°† gif_frame è½¬ä¸º [x, y, 3] çš„ä¸‰ç»´æ•°ç»„
    frame = np.asarray(
            gif_frame.convert('RGB').getdata(),
            dtype=np.uint8
        ).reshape(gif_frame.size[1], gif_frame.size[0], 3)

    dbs = []  # è¯¥ frame ä¸­ï¼Œé¢‘ç‡å¯¹åº”çš„ dB

    for freq in range(0, num_freqs):
        for i, threshold in enumerate(list(range(min_db, max_db + 1, quantize))[::-1], start=1):
            x = threshold - min_db
            y = (freq * 2 + 1) * 2
            color = frame[x][y]
            if (color == white_pixel).all():
                dbs.append(i - 1)
                break

    db_frames.append(dbs)
```

éšåå°±æ˜¯è¦é€†å‘è¿™ä¸ª `melspectrogram`ã€‚çœ‹æºä»£ç ï¼š

```python
spectrogram = (
    numpy.around(
        librosa.power_to_db(
            librosa.feature.melspectrogram(
                ...
            )
        ) / quantize
    ) * quantize
)
```

æœ€å¤–å±‚ï¼Œ`/ quantize`, `numpy.around`, `* quantize` å°±æ˜¯å°† dB å–æ•´ã€‚

ç„¶åå†é‡Œé¢ä¸€å±‚ï¼Œå°±æ˜¯ `librosa.power_to_db`ï¼Œçœ‹è¿™ä¸ªå‘½åâ€¦â€¦ç›²çŒœä¸€ä¸‹â€¦â€¦å¤§æ¦‚æœ‰ä¸ªå‡½æ•°â€¦â€¦å¯ä»¥æŠŠå®ƒåè¿‡æ¥ï¼Œè¿˜çœŸæœ‰ï¼š`librosa.db_to_power`ã€‚

å†é‡Œé¢ä¸€å±‚ï¼Œå°±æ˜¯ FFT å¤§å¤´ï¼Œ`librosa.feature.melspectrogram`ï¼Œæœ¬æ¥å‘¢ï¼Œæˆ‘è¿˜åšå¥½å‡†å¤‡è¦æ‰‹æ’• FFT çš„ï¼Œç„¶åä¸€æŸ¥æ–‡æ¡£ï¼Œå‘ç°å¥½å®¶ä¼™ï¼Œè¿™å‡½æ•°ä¹Ÿæœ‰é€†å‡½æ•° `librosa.feature.inverse.mel_to_audio`ï¼Œè¿™å°±çœäº‹äº†ã€‚

æ¥ä¸‹æ¥çš„äº‹å°±æ˜¯æŠŠä¸Šé¢çš„è¿‡ç¨‹åè¿‡æ¥å¥—ä¸€éå°±å¯ä»¥äº†ï¼š

```python
db_frames = [ ... ]  # ä¸Šé¢çš„ db_frames

frames = np.array(db_frames).transpose(1, 0)  # äº¤æ¢ä¸¤ç»´ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºå•¥è¦è¿™æ ·ï¼Œåæ­£æ¥å£è¦å¯¹ä¸Šå°±å¯¹äº†
frames += min_db
# å¦‚æœè€ƒè™‘ä¸Šé¢çš„å¯¹ 2 å–æ•´çš„è¯ï¼Œå®é™…ä¸Šè¿˜è¦åŠ ä¸ŠæœŸæœ›å€¼ 1 æ‰å¯¹ï¼Ÿ

y = librosa.feature.inverse.mel_to_audio(
    librosa.db_to_power(frames),
    22050,  # sample_rate
    n_fft=fft_window_size,
    hop_length=frame_step_size,
    window=window_function_type
)

sf.write('origin.wav', y, 22050)
```

è‡³æ­¤ï¼Œæˆ‘ä»¬å°±æŠŠ gif é€†å‘æˆäº† `origin.wav`ã€‚

éŸ³é¢‘æ˜¯ã€ŒThe flag is, F-L-A-G, 634,971,243,582ã€ã€‚
